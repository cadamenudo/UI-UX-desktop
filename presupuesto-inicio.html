<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Configurar presupuesto – Cada Menudo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Nunito -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root {
      --cm-primary: #3956e8;
      --cm-secondary: #7459d9;
      --cm-bg: #f5f6ff;
      --cm-card-bg: #ffffff;
      --cm-text: #0f172a;
      --cm-muted: #64748b;
      --cm-border: #e5e7eb;
      --cm-success-bg: #ecfdf3;
      --cm-success-text: #15803d;
      --radius-card: 16px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--cm-bg);
      color: var(--cm-text);
    }

    .cm-page {
      padding: 24px 32px 32px;
      max-width: 1100px;
      margin: 0 auto;
    }

    /* Header */
    .cm-page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .cm-page-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cm-breadcrumb {
      font-size: 0.8rem;
      color: var(--cm-muted);
    }

    .cm-page-title h1 {
      font-size: 1.8rem;
      font-weight: 800;
    }

    .cm-page-subtitle {
      font-size: 0.95rem;
      color: var(--cm-muted);
      margin-top: 4px;
    }

    .cm-page-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .cm-select {
      border-radius: 999px;
      border: 1px solid var(--cm-border);
      background: #fff;
      font-size: 0.9rem;
      padding: 6px 12px;
      color: var(--cm-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.04);
    }

    /* Cards base */
    .cm-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 18px 20px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 18px;
    }

    .cm-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .cm-card-title {
      font-size: 1rem;
      font-weight: 700;
    }

    .cm-card-subtitle {
      font-size: 0.85rem;
      color: var(--cm-muted);
      margin-top: 2px;
    }

    /* Toggle tipo presupuesto */
    .cm-segment {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: #eef2ff;
      gap: 4px;
      margin-top: 10px;
    }

    .cm-segment button {
      border: none;
      background: transparent;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.9rem;
      color: var(--cm-muted);
      cursor: pointer;
    }

    .cm-segment button.active {
      background: #ffffff;
      color: var(--cm-primary);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(148, 163, 184, 0.4);
    }

    .cm-type-row {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .cm-select-inline {
      border-radius: 999px;
      border: 1px solid var(--cm-border);
      background: #fff;
      padding: 6px 12px;
      font-size: 0.9rem;
      color: var(--cm-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      min-width: 120px;
    }

    .cm-helper-text {
      font-size: 0.8rem;
      color: var(--cm-muted);
      margin-top: 6px;
    }

    .cm-highlight {
      color: var(--cm-primary);
      font-weight: 600;
    }

    /* Contenedor de categorías */
    .cm-categories-wrapper {
      margin-top: 10px;
      border-radius: 14px;
      border: 1px dashed var(--cm-border);
      background: #f9fafb;
      padding: 10px 12px 16px;
      font-size: 0.85rem;
      color: var(--cm-muted);
    }

    /* Botón principal */
    .cm-actions-row {
      margin-top: 18px;
      display: flex;
      justify-content: flex-end;
    }

    .cm-btn-primary {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--cm-primary), var(--cm-secondary));
      color: #ffffff;
      font-size: 0.95rem;
      padding: 10px 24px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(55, 65, 81, 0.25);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .cm-btn-primary:hover {
      opacity: 0.95;
      transform: translateY(-1px);
    }

    /* ===================== */
    /*   ESTILOS CATEGORÍAS  */
    /* ===================== */

    .seccion-categorias {
      margin-top: 0.5rem;
    }

    .titulo-categorias {
      font-size: 1.1rem;
      font-weight: 700;
      color: #111827;
      margin: 0.5rem 0 1rem 0;
      padding-left: 0.25rem;
    }

    .bloque-sector {
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
      margin: 0 auto 1.2rem;
      max-width: 100%;
    }

    .encabezado {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.75rem;
      font-size: 1.05rem;
      font-weight: bold;
      padding: 1.1rem 1rem;
      cursor: pointer;
    }

    .icono-ingresos,
    .icono-gastos,
    .icono-ahorro {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: 32px;
      background-repeat: no-repeat;
      background-position: center;
    }

    .icono-ingresos {
      background-color: #F4F2FF;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/ingreso.png');
    }

    .icono-gastos {
      background-color: #F3F4F6;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/gastos.png');
    }

    .icono-ahorro {
      background-color: #FCFAEA;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/ahorro.png');
    }

    .contenido-bloque {
      display: none;
      padding: 1rem 2rem;
    }

    .bloque-sector.abierto .contenido-bloque {
      display: block;
    }

    .bloque-categoria {
      background: #fff;
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 1rem;
    }

    .titulo-categoria {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
    }

    .subcategorias {
      margin-top: 0.75rem;
      padding-left: 1rem;
      display: none;
    }

    .subcategorias.activo {
      display: block;
    }

    .fila {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #4F46E5;
    }

    input:checked + .slider:before {
      transform: translateX(20px);
    }

    .acciones {
      margin-top: 1rem;
      text-align: right;
    }

    .acciones button {
      background: #7459D9;
      color: white;
      border: none;
      padding: 0.4rem 0.75rem;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      margin-left: 0.5rem;
    }

    .editable-span {
      cursor: pointer;
    }

    .editable-input {
      font-family: inherit;
      font-size: 1rem;
      padding: 2px 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .titulo-categoria button,
    .fila-subcategoria button {
      background: none;
      border: none;
      color: #888;
      font-size: 1.1rem;
      cursor: pointer;
      margin-right: 0.5rem;
    }

    .modal-subcategoria {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(17, 24, 39, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      display: none;
    }

    .modal-subcategoria.abierto {
      display: flex;
    }

    .modal-contenido {
      background: #fff;
      border-radius: 16px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .modal-contenido h3 {
      margin-top: 0;
      font-size: 1.25rem;
      color: #111827;
      font-weight: bold;
      margin-bottom: 1.5rem;
    }

    .modal-contenido label {
      display: block;
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
      margin-top: 1rem;
      color: #111827;
    }

    .modal-contenido input,
    .modal-contenido select,
    .modal-contenido textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #D1D5DB;
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      box-sizing: border-box;
      margin-bottom: 0.5rem;
    }

    .modal-contenido textarea {
      resize: vertical;
      min-height: 60px;
    }

    .modal-botones {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 2rem;
    }

    .modal-botones .cancelar {
      background: #F8F6FF !important;
      color: #4B0082 !important;
      padding: 0.75rem 1.5rem !important;
      font-size: 1rem !important;
      font-weight: 600 !important;
      border: none !important;
      border-radius: 8px !important;
      cursor: pointer !important;
    }

    .modal-botones .guardar {
      background: #3956E8 !important;
      color: white !important;
      padding: 0.75rem 1.5rem !important;
      font-size: 1rem !important;
      font-weight: 600 !important;
      border: none !important;
      border-radius: 8px !important;
      cursor: pointer !important;
    }

    .pildora-recurrencia {
      background: #ECFDF3;
      color: #00AC4F;
      font-size: 0.75rem;
      font-weight: 500;
      border-radius: 999px;
      padding: 0.15rem 0.5rem;
      margin-left: 0.4rem;
      display: inline-block;
    }

    @media (max-width: 960px) {
      .cm-page {
        padding: 16px;
      }
      .cm-page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .cm-page-controls {
        align-self: stretch;
        justify-content: flex-start;
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <main class="cm-page">
    <!-- Header -->
    <header class="cm-page-header">
      <div class="cm-page-title">
        <span class="cm-breadcrumb">Tablero / Presupuesto</span>
        <h1>Configurar presupuesto</h1>
        <p class="cm-page-subtitle">
          Elige si será <strong>mensual</strong> o <strong>anual</strong> y el periodo.
        </p>
      </div>
    </header>

    <!-- 1. Tipo de presupuesto -->
    <section class="cm-card">
      <div class="cm-card-header">
        <div>
          <div class="cm-card-title">1. Tipo de presupuesto</div>
          <div class="cm-card-subtitle">
            Mensual o anual para este periodo.
          </div>
        </div>
      </div>

      <div class="cm-type-row">
        <div class="cm-segment">
          <button class="active" type="button">Mensual</button>
          <button type="button">Anual</button>
        </div>

        <div class="cm-select-inline">
          <span>Mes:</span> <strong>Enero 2025</strong> ⌄
        </div>
      </div>

      <p class="cm-helper-text">
        Si eliges <span class="cm-highlight">mensual</span>, aplica solo al mes seleccionado.
      </p>
    </section>

    <!-- 2. Seleccionar categorías -->
    <section class="cm-card">
      <div class="cm-card-header">
        <div>
          <div class="cm-card-title">2. Categorías del presupuesto</div>
          <div class="cm-card-subtitle">
            Activa solo lo que usarás este periodo.
          </div>
        </div>
      </div>

      <div class="cm-categories-wrapper">
        <section class="seccion-categorias">
          <h3 class="titulo-categorias">Lista de Categorías</h3>

          <!-- INGRESOS -->
          <div class="bloque-sector">
            <div class="encabezado" onclick="toggleBloque(this)">
              <div class="icono-ingresos"></div>
              <span>Ingresos</span>
            </div>
            <div class="contenido-bloque">

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Pago por trabajo</span>
                  <button style="display:none;"></button>
                  <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Bono"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Bono</span>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Comisión"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Comisión</span>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Negocio propio"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Negocio propio</span>
                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Pago por hora"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Pago por hora</span>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Propina"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Propina</span>
                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Salario"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Salario</span>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  </div>
                  <div class="acciones">
                    <button onclick="anadirSubcategoria(this)">+ Subcategoría</button>
                  </div>
                </div>
              </div>

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Ganancia de capital</span>
                  <button style="display:none;"></button>
                  <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Acciones"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Acciones</span>
                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Auto"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Auto</span>
                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Bonos o renta fija"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Bonos o renta fija</span>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Casa/Apartamento/Tierra"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Casa/Apartamento/Tierra</span>
                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="ETF, fondo mutuo, etc."
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">ETF, fondo mutuo, etc.</span>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  </div>
                  <div class="acciones">
                    <button onclick="anadirSubcategoria(this)">+ Subcategoría</button>
                  </div>
                </div>
              </div>

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Ingreso pasivo</span>
                  <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Anualidad"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Anualidad</span>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Dividendos e Intereses"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Dividendos e Intereses</span>
                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Pensión"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Pensión</span>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Renta inmueble"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Renta inmueble</span>
                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Seguro Social"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Seguro Social</span>
                    <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  </div>
                  <div class="acciones">
                    <button onclick="anadirSubcategoria(this)">+ Subcategoría</button>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- GASTOS -->
          <div class="bloque-sector">
            <div class="bloque-gastos">
              <div class="encabezado" onclick="toggleBloque(this)">
                <div class="icono-gastos"></div>
                <span>Gastos</span>
              </div>
              <div class="contenido-bloque">
                <div id="contenedorGastos"></div>
                <div class="acciones">
                  <button onclick="anadirCategoria()">+ Categoría</button>
                </div>
              </div>
            </div>
          </div>

          <!-- AHORRO -->
          <div class="bloque-sector">
            <div class="bloque-ahorro">
              <div class="encabezado" onclick="toggleBloque(this)">
                <div class="icono-ahorro"></div>
                <span>Ahorro</span>
              </div>
              <div class="contenido-bloque">
                <div id="contenedorAhorro"></div>
                <div class="acciones">
                  <button onclick="anadirCategoriaAhorro()">+ Categoría</button>
                </div>
              </div>
            </div>
          </div>

          <!-- MODAL SUBCATEGORIAS -->
          <div id="modalSubcategoria" class="modal-subcategoria">
            <div class="modal-contenido">
              <h3>Subcategoría</h3>

              <label for="nombreSub">Nombre</label>
              <input type="text" id="nombreSub" placeholder="Ej. Comisión extra" />

              <label for="inputRecurrencia">Recurrencia</label>
              <select id="inputRecurrencia">
                <option value="">Ninguna</option>
                <option value="diario">Diario</option>
                <option value="semanal">Semanal</option>
                <option value="quincenal">Quincenal</option>
                <option value="mensual">Mensual</option>
                <option value="anual">Anual</option>
              </select>

              <div id="grupoMonto" style="display: none;">
                <label for="montoRecurrencia">Monto</label>
                <input type="number" id="montoRecurrencia" placeholder="$0.00" />
              </div>

              <label for="descripcion">Descripción (opcional)</label>
              <textarea id="descripcion" placeholder="Descripción breve..."></textarea>

              <div class="modal-botones">
                <button class="cancelar" type="button">Cancelar</button>
                <button class="guardar" type="button">Guardar</button>
              </div>
            </div>
          </div>
        </section>
      </div>

      <p class="cm-helper-text">
        Tip: empieza con pocas categorías.
      </p>
    </section>

    <!-- Botón continuar -->
    <div class="cm-actions-row">
      <button class="cm-btn-primary" type="button">
        Ir a montos
      </button>
    </div>
  </main>

  <script>
    // --- Funciones base de bloques ---

    function toggleBloque(encabezado) {
      const parent = encabezado.closest('.bloque-sector');
      document.querySelectorAll('.bloque-sector').forEach(b => {
        if (b !== parent) b.classList.remove('abierto');
      });
      parent.classList.toggle('abierto');
    }

    function toggleSubcategorias(element) {
      const all = document.querySelectorAll('.subcategorias');
      all.forEach(sc => {
        if (sc !== element.nextElementSibling) sc.classList.remove('activo');
      });
      element.nextElementSibling.classList.toggle('activo');
    }

    // --- Configuración al cargar ---

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.bloque-sector').forEach(b => b.classList.remove('abierto'));

      Object.entries(categoriasGastos).forEach(([categoria, subcategorias]) => {
        agregarCategoria(categoria, subcategorias, false);
      });

      Object.entries(categoriasAhorro).forEach(([categoria, subcategorias]) => {
        agregarCategoriaAhorro(categoria, subcategorias, false);
      });
    });

    // --- Categorías de GASTOS ---

    const categoriasGastos = {
      'Alimentación': ['Supermercado', 'Comidas fuera', 'Pedido a domicilio'],
      'Casa': ['Hipoteca / Alquiler', 'Servicios básicos', 'Mantenimiento'],
      'Impuestos': ['Seguro social', 'Propiedad', 'Venta', 'Estatales', 'Federales', 'Municipales'],
      'Transportación': ['Gasolina', 'Mantenimiento', 'Transporte público / Uber'],
      'Seguros': ['Salud', 'Auto', 'Vida'],
      'Regalos y donaciones': ['Familia', 'Amigos', 'Instituciones'],
      'Gastos Médicos': ['Consultas', 'Medicamentos', 'Procedimientos'],
      'Cuidado Personal': ['Peluquería', 'Cosméticos', 'Spa / Barbería'],
      'Dependientes': ['Cuidado de niños', 'Cuidado de mayores', 'Educación'],
      'Deuda': ['Tarjetas de crédito', 'Préstamos estudiantiles', 'Otros préstamos'],
      'Entretenimiento': ['Cine', 'Conciertos', 'Streaming'],
      'Telecomunicaciones': ['Teléfono', 'Internet', 'TV']
    };

    const contenedor = document.getElementById('contenedorGastos');

    function agregarCategoria(nombre, subcategorias = [], editable = false) {
      const div = document.createElement('div');
      div.className = 'bloque-categoria';

      const titulo = document.createElement('div');
      titulo.className = 'titulo-categoria';
      titulo.onclick = () => toggleSubcategorias(titulo);

      const contenedorIzq = document.createElement('div');
      contenedorIzq.style.display = 'flex';
      contenedorIzq.style.alignItems = 'center';
      contenedorIzq.style.gap = '0.5rem';

      if (editable) {
        const borrar = document.createElement('button');
        borrar.textContent = '✖';
        borrar.onclick = e => {
          e.stopPropagation();
          div.remove();
        };
        contenedorIzq.appendChild(borrar);
      }

      const nombreSpan = document.createElement('span');
      nombreSpan.textContent = nombre;
      contenedorIzq.appendChild(nombreSpan);

      const switchLabel = document.createElement('label');
      switchLabel.className = 'switch';
      switchLabel.innerHTML = `<input type="checkbox" checked><span class="slider"></span>`;

      titulo.appendChild(contenedorIzq);
      titulo.appendChild(switchLabel);

      const subDiv = document.createElement('div');
      subDiv.className = 'subcategorias';

      subcategorias.forEach(sub => {
        const fila = document.createElement('div');
        fila.className = 'fila';

        const contenedorIzq = document.createElement('div');
        contenedorIzq.style.display = 'flex';
        contenedorIzq.style.alignItems = 'center';
        contenedorIzq.style.gap = '0.5rem';

        const span = document.createElement('span');
        span.className = 'editable-span';
        span.innerHTML = sub;
        span.setAttribute('data-nombre', sub);
        span.setAttribute('data-recurrencia', '');
        span.setAttribute('data-monto', '');
        span.setAttribute('data-descripcion', '');

        span.onclick = (e) => {
          e.stopPropagation();
          abrirModalSubcategoria(
            span.getAttribute('data-nombre') || '',
            (data) => {
              if (!data.nombre) return;

              span.innerHTML = data.recurrencia
                ? `${data.nombre} <span class="pildora-recurrencia">↻ ${data.recurrencia}</span>`
                : data.nombre;

              span.setAttribute('data-nombre', data.nombre);
              span.setAttribute('data-recurrencia', data.recurrencia || '');
              span.setAttribute('data-monto', data.monto || '');
              span.setAttribute('data-descripcion', data.descripcion || '');
            },
            {
              nombre: span.getAttribute('data-nombre') || '',
              recurrencia: span.getAttribute('data-recurrencia') || '',
              monto: span.getAttribute('data-monto') || '',
              descripcion: span.getAttribute('data-descripcion') || ''
            }
          );
        };

        contenedorIzq.appendChild(span);
        fila.appendChild(contenedorIzq);

        const switchLabel = document.createElement('label');
        switchLabel.className = 'switch';
        switchLabel.innerHTML = `<input type="checkbox" checked><span class="slider"></span>`;
        fila.appendChild(switchLabel);

        subDiv.appendChild(fila);
      });

      const acciones = document.createElement('div');
      acciones.className = 'acciones';
      const btn = document.createElement('button');
      btn.textContent = '+ Subcategoría';
      btn.onclick = () => anadirSubcategoria(titulo, subDiv);
      acciones.appendChild(btn);
      subDiv.appendChild(acciones);

      div.appendChild(titulo);
      div.appendChild(subDiv);
      contenedor.appendChild(div);
    }

    function anadirCategoria() {
      if (contenedor.querySelector('input.editable-input')) return;

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Nombre de categoría';
      input.className = 'editable-input';

      input.onkeydown = function (e) {
        if (e.key === 'Enter') {
          const nombre = input.value.trim();
          if (nombre) {
            const div = document.createElement('div');
            div.className = 'bloque-categoria';

            const titulo = document.createElement('div');
            titulo.className = 'titulo-categoria';
            titulo.setAttribute('onclick', 'toggleSubcategorias(this)');

            const contenedorIzq = document.createElement('div');
            contenedorIzq.style.display = 'flex';
            contenedorIzq.style.alignItems = 'center';
            contenedorIzq.style.gap = '0.5rem';

            const borrarBtn = document.createElement('button');
            borrarBtn.textContent = '✖';
            borrarBtn.onclick = function(e) {
              e.stopPropagation();
              div.remove();
            };

            const span = document.createElement('span');
            span.textContent = nombre;

            contenedorIzq.appendChild(borrarBtn);
            contenedorIzq.appendChild(span);

            const switchLabel = document.createElement('label');
            switchLabel.className = 'switch';
            switchLabel.innerHTML = `<input type="checkbox" checked><span class="slider"></span>`;

            titulo.appendChild(contenedorIzq);
            titulo.appendChild(switchLabel);

            const subDiv = document.createElement('div');
            subDiv.className = 'subcategorias';

            const acciones = document.createElement('div');
            acciones.className = 'acciones';
            const boton = document.createElement('button');
            boton.textContent = '+ Subcategoría';
            boton.onclick = () => anadirSubcategoria(titulo, subDiv);
            acciones.appendChild(boton);

            subDiv.appendChild(acciones);
            div.appendChild(titulo);
            div.appendChild(subDiv);
            contenedor.appendChild(div);

            input.remove();
          }
        } else if (e.key === 'Escape') {
          input.remove();
        }
      };

      contenedor.appendChild(input);
      input.focus();
    }

    function anadirSubcategoria(tituloCategoria, subDiv) {
      abrirModalSubcategoria('', (data) => {
        if (!data.nombre) return;

        const fila = document.createElement('div');
        fila.className = 'fila';

        const contenedorIzq = document.createElement('div');
        contenedorIzq.style.display = 'flex';
        contenedorIzq.style.alignItems = 'center';
        contenedorIzq.style.gap = '0.5rem';

        const esEditable = tituloCategoria.querySelector('button') !== null;

        if (esEditable) {
          const borrarBtn = document.createElement('button');
          borrarBtn.textContent = '✖';
          borrarBtn.onclick = e => {
            e.stopPropagation();
            fila.remove();
          };
          contenedorIzq.appendChild(borrarBtn);
        }

        const span = document.createElement('span');
        span.className = 'editable-span';

        span.innerHTML = data.recurrencia
          ? `${data.nombre} <span class="pildora-recurrencia">↻ ${data.recurrencia}</span>`
          : data.nombre;

        span.setAttribute('data-nombre', data.nombre);
        span.setAttribute('data-recurrencia', data.recurrencia || '');
        span.setAttribute('data-monto', data.monto || '');
        span.setAttribute('data-descripcion', data.descripcion || '');

        span.onclick = (e) => {
          e.stopPropagation();
          abrirModalSubcategoria(
            span.getAttribute('data-nombre') || '',
            (newData) => {
              if (!newData.nombre) return;

              span.innerHTML = newData.recurrencia
                ? `${newData.nombre} <span class="pildora-recurrencia">↻ ${newData.recurrencia}</span>`
                : newData.nombre;

              span.setAttribute('data-nombre', newData.nombre);
              span.setAttribute('data-recurrencia', newData.recurrencia || '');
              span.setAttribute('data-monto', newData.monto || '');
              span.setAttribute('data-descripcion', newData.descripcion || '');
            },
            {
              nombre: span.getAttribute('data-nombre') || '',
              recurrencia: span.getAttribute('data-recurrencia') || '',
              monto: span.getAttribute('data-monto') || '',
              descripcion: span.getAttribute('data-descripcion') || ''
            }
          );
        };

        contenedorIzq.appendChild(span);

        const switchLabel = document.createElement('label');
        switchLabel.className = 'switch';
        switchLabel.innerHTML = `<input type="checkbox" checked><span class="slider"></span>`;

        fila.appendChild(contenedorIzq);
        fila.appendChild(switchLabel);

        subDiv.insertBefore(fila, subDiv.querySelector('.acciones'));
      });
    }

    // --- Categorías AHORRO ---

    const categoriasAhorro = {
      'Emergencia': ['Fondo corto plazo', 'Fondo largo plazo', 'Reserva médica'],
      'Meta específica': ['Vacaciones', 'Auto', 'Casa', 'Boda', 'Educación de hijos'],
      'Inversión': ['Cuenta brokerage', 'Fondo indexado', 'Cripto', 'Crowdfunding'],
      'Retiro': ['IRA / Roth IRA', '401(k)', 'Pensión privada'],
      'Ahorro personal': ['Ahorro mensual', 'Ahorro en efectivo', 'Cuenta de ahorro tradicional'],
      'Ahorro para hijos': ['Educación', 'Regalos futuros', 'Fondo universitario'],
      'Otros': ['Donaciones planificadas', 'Proyectos personales', 'Fondo de libertad financiera']
    };

    const contenedorAhorro = document.getElementById('contenedorAhorro');

    function agregarCategoriaAhorro(nombre, subcategorias = [], editable = false) {
      const div = document.createElement('div');
      div.className = 'bloque-categoria';

      const titulo = document.createElement('div');
      titulo.className = 'titulo-categoria';
      titulo.onclick = () => toggleSubcategorias(titulo);

      const contenedorIzq = document.createElement('div');
      contenedorIzq.style.display = 'flex';
      contenedorIzq.style.alignItems = 'center';
      contenedorIzq.style.gap = '0.5rem';

      if (editable) {
        const borrar = document.createElement('button');
        borrar.textContent = '✖';
        borrar.onclick = e => {
          e.stopPropagation();
          div.remove();
        };
        contenedorIzq.appendChild(borrar);
      }

      const nombreSpan = document.createElement('span');
      nombreSpan.textContent = nombre;
      contenedorIzq.appendChild(nombreSpan);

      const switchLabel = document.createElement('label');
      switchLabel.className = 'switch';
      switchLabel.innerHTML = `<input type="checkbox" checked><span class="slider"></span>`;

      titulo.appendChild(contenedorIzq);
      titulo.appendChild(switchLabel);

      const subDiv = document.createElement('div');
      subDiv.className = 'subcategorias';

      subcategorias.forEach(sub => {
        const fila = document.createElement('div');
        fila.className = 'fila';

        const contenedorIzq = document.createElement('div');
        contenedorIzq.style.display = 'flex';
        contenedorIzq.style.alignItems = 'center';
        contenedorIzq.style.gap = '0.5rem';

        const span = document.createElement('span');
        span.className = 'editable-span';
        span.innerHTML = sub;
        span.setAttribute('data-nombre', sub);
        span.setAttribute('data-recurrencia', '');
        span.setAttribute('data-monto', '');
        span.setAttribute('data-descripcion', '');

        span.onclick = (e) => {
          e.stopPropagation();
          abrirModalSubcategoria(
            span.getAttribute('data-nombre') || '',
            (data) => {
              if (!data.nombre) return;

              span.innerHTML = data.recurrencia
                ? `${data.nombre} <span class="pildora-recurrencia">↻ ${data.recurrencia}</span>`
                : data.nombre;

              span.setAttribute('data-nombre', data.nombre);
              span.setAttribute('data-recurrencia', data.recurrencia || '');
              span.setAttribute('data-monto', data.monto || '');
              span.setAttribute('data-descripcion', data.descripcion || '');
            },
            {
              nombre: span.getAttribute('data-nombre') || '',
              recurrencia: span.getAttribute('data-recurrencia') || '',
              monto: span.getAttribute('data-monto') || '',
              descripcion: span.getAttribute('data-descripcion') || ''
            }
          );
        };

        contenedorIzq.appendChild(span);
        fila.appendChild(contenedorIzq);

        const switchLabel = document.createElement('label');
        switchLabel.className = 'switch';
        switchLabel.innerHTML = `<input type="checkbox" checked><span class="slider"></span>`;
        fila.appendChild(switchLabel);

        subDiv.appendChild(fila);
      });

      const acciones = document.createElement('div');
      acciones.className = 'acciones';
      const btn = document.createElement('button');
      btn.textContent = '+ Subcategoría';
      btn.onclick = () => anadirSubcategoria(titulo, subDiv);
      acciones.appendChild(btn);
      subDiv.appendChild(acciones);

      div.appendChild(titulo);
      div.appendChild(subDiv);
      contenedorAhorro.appendChild(div);
    }

    function anadirCategoriaAhorro() {
      const input = document.createElement('input');
      input.className = 'editable-input';
      input.placeholder = 'Nueva categoría';

      input.onkeydown = function (e) {
        if (e.key === 'Enter') {
          const nombre = input.value.trim();
          if (nombre) {
            agregarCategoriaAhorro(nombre, [], true);
            input.remove();
          }
        } else if (e.key === 'Escape') {
          input.remove();
        }
      };

      contenedorAhorro.appendChild(input);
      input.focus();
    }

    // --- Modal subcategorías ---

    const modal = document.getElementById('modalSubcategoria');

    function abrirModalSubcategoria(textoInicial = '', callbackAceptar, datosPrevios = {}) {
      document.getElementById('nombreSub').value = textoInicial;
      document.getElementById('inputRecurrencia').value = datosPrevios.recurrencia || '';
      document.getElementById('montoRecurrencia').value = datosPrevios.monto || '';
      document.getElementById('descripcion').value = datosPrevios.descripcion || '';

      const grupoMonto = document.getElementById('grupoMonto');
      if (datosPrevios.recurrencia) {
        grupoMonto.style.display = 'block';
      } else {
        grupoMonto.style.display = 'none';
      }

      modal.style.display = 'flex';

      const aceptar = modal.querySelector('.guardar');
      const cancelar = modal.querySelector('.cancelar');

      const cerrar = () => {
        modal.style.display = 'none';
        aceptar.onclick = null;
        cancelar.onclick = null;
      };

      aceptar.onclick = () => {
        const nombre = document.getElementById('nombreSub').value.trim();
        const recurrencia = document.getElementById('inputRecurrencia').value;
        const monto = parseFloat(document.getElementById('montoRecurrencia').value) || null;
        const descripcion = document.getElementById('descripcion').value.trim();
        callbackAceptar({ nombre, recurrencia, monto, descripcion });
        cerrar();
      };

      cancelar.onclick = cerrar;
    }

    document.addEventListener('click', function (e) {
      if (e.target.classList.contains('editable-span')) {
        const span = e.target;

        abrirModalSubcategoria(
          span.getAttribute('data-nombre') || '',
          (data) => {
            if (!data.nombre) return;

            span.innerHTML = data.recurrencia
              ? `${data.nombre} <span class="pildora-recurrencia">↻ ${data.recurrencia}</span>`
              : data.nombre;

            span.setAttribute('data-nombre', data.nombre);
            span.setAttribute('data-recurrencia', data.recurrencia || '');
            span.setAttribute('data-monto', data.monto || '');
            span.setAttribute('data-descripcion', data.descripcion || '');
          },
          {
            nombre: span.getAttribute('data-nombre') || '',
            recurrencia: span.getAttribute('data-recurrencia') || '',
            monto: span.getAttribute('data-monto') || '',
            descripcion: span.getAttribute('data-descripcion') || ''
          }
        );
      }
    });

    document.addEventListener('change', function (e) {
      if (e.target && e.target.id === 'inputRecurrencia') {
        const grupoMonto = document.getElementById('grupoMonto');
        const montoInput = document.getElementById('montoRecurrencia');
        const seleccion = e.target.value;

        if (!seleccion) {
          grupoMonto.style.display = 'none';
          montoInput.value = '';
        } else {
          grupoMonto.style.display = 'block';
        }
      }
    });
  </script>
</body>
</html>


