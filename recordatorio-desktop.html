<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lista de Recordatorios ‚Äì Cada Menudo</title>

<!-- Nunito -->
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet"/>

<style>
:root{
  --primary:#3956E8; --secondary:#7459D9; --accent:#E8C239;
  --bg:#F7F8FC; --card:#ffffff; --ink:#0f172a; --muted:#64748B; --line:#e5e7eb;
  --shadow:0 8px 28px rgba(15,23,42,.08); --soft:#FAFBFF; --ok:#10b981; --radius:16px;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:'Nunito',system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
a{color:var(--primary);text-decoration:none}
.wrap{max-width:1180px;margin:28px auto;padding:0 20px}
/* Header */
.header{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:20px 24px;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:space-between;gap:16px}
.title h1{margin:0;font-size:22px;font-weight:800;letter-spacing:.2px}
.chip{display:inline-flex;align-items:center;gap:6px;background:#f3f6ff;color:var(--primary);padding:6px 10px;border-radius:999px;border:1px solid #e8edff;font-weight:700;font-size:12px;margin-left:8px}
.actions{display:flex;gap:10px;align-items:center}
.btn{display:inline-flex;gap:8px;align-items:center;justify-content:center;height:40px;border-radius:12px;border:1px solid var(--line);padding:0 14px;font-weight:700;font-size:14px;background:#fff;color:var(--ink);cursor:pointer}
.btn:hover{background:#fafafa}
.btn.primary{border-color:transparent;background:var(--primary);color:#fff;box-shadow:0 8px 18px rgba(57,86,232,.25)}
/* Tabla */
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);margin-top:16px;box-shadow:var(--shadow);overflow:hidden}
table{width:100%;border-collapse:separate;border-spacing:0}
thead th{text-align:left;background:var(--soft);color:var(--muted);font-weight:700;font-size:12px;letter-spacing:.5px;text-transform:uppercase;padding:14px 18px;border-bottom:1px solid var(--line)}
tbody td{padding:16px 18px;border-bottom:1px solid var(--line);font-size:15px;vertical-align:middle}
tbody tr:last-child td{border-bottom:none}
.titleCell{font-weight:700}
.muted{color:var(--muted)}
.freq a{font-weight:700}
.complete-box{width:20px;height:20px;border:2px solid #cbd5e1;border-radius:4px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;background:#fff;user-select:none;font-size:14px;line-height:1;color:#fff}
.complete-box.done{background:var(--primary);border-color:var(--primary);color:#fff}
.checkmark{opacity:0;transform:scale(.9);transition:.12s}
.complete-box.done .checkmark{opacity:1;transform:scale(1)}
.ellipsis{width:34px;height:34px;border-radius:10px;border:1px solid var(--line);display:flex;align-items:center;justify-content:center;background:#fff;cursor:pointer}
.menu{position:absolute;z-index:50;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);padding:6px;display:none;min-width:210px}
.menu.open{display:block}
.menu button{display:flex;gap:10px;align-items:center;width:100%;border:0;background:transparent;padding:10px;border-radius:10px;font-size:14px;cursor:pointer}
.menu button:hover{background:#f7f7fb}
/* Footer tabla */
.tableFoot{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-top:1px solid var(--line);background:#fff}
.rows{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:14px}
.pager{display:flex;gap:6px}
.pbtn{width:36px;height:36px;border-radius:10px;border:1px solid var(--line);background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
.pbtn:disabled{opacity:.45;cursor:not-allowed}
/* Modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.35);display:none;align-items:center;justify-content:center;padding:20px;z-index:100}
.modal{background:#fff;border-radius:18px;border:1px solid var(--line);box-shadow:var(--shadow);max-width:640px;width:100%}
.modal header{padding:18px 20px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between}
.modal header h3{margin:0;font-size:18px}
.modal .content{padding:18px 20px;display:grid;grid-template-columns:1fr 1fr;gap:14px}
.modal .content .full{grid-column:1/-1}
.modal footer{padding:16px 20px;border-top:1px solid var(--line);display:flex;gap:10px;justify-content:flex-end}
.field{display:flex;flex-direction:column;gap:6px}
.field label{font-weight:700;font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
.field input[type="text"], .field input[type="datetime-local"], .field select, .field textarea{border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-size:14px}
textarea{min-height:90px;resize:vertical}
/* Toast */
.toast{position:fixed;right:20px;bottom:20px;background:#111827;color:#fff;padding:10px 12px;border-radius:12px;font-weight:700;opacity:0;transform:translateY(10px);transition:.25s;z-index:200}
.toast.show{opacity:1;transform:translateY(0)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <h1>Lista de Recordatorios <span class="chip">Vista general</span></h1>
      </div>
      <div class="actions">
        <button id="btnFilters" class="btn" title="Filtros">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 5h18M6 12h12M10 19h4" stroke="#0f172a" stroke-width="2" stroke-linecap="round"/></svg>
          Filtros
        </button>
        <button id="btnNew" class="btn primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>
          Nueva entrada
        </button>
      </div>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th style="width:34%;">T√≠tulo</th>
            <th style="width:22%;">Fecha</th>
            <th style="width:12%;">Completado</th>
            <th style="width:24%;">Descripci√≥n</th>
            <th style="width:8%;text-align:right;padding-right:14px;">&nbsp;</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      <div class="tableFoot">
        <div class="rows">
          Filas
          <select id="rows"><option>10</option><option>25</option><option>50</option></select>
          <span id="range" class="muted"></span>
        </div>
        <div class="pager">
          <button class="pbtn" id="first" title="Primera">‚ü™</button>
          <button class="pbtn" id="prev" title="Anterior">‚Äπ</button>
          <div class="pbtn" style="cursor:default" id="pageLabel">1</div>
          <button class="pbtn" id="next" title="Siguiente">‚Ä∫</button>
          <button class="pbtn" id="last" title="√öltima">‚ü´</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Men√∫ contextual -->
  <div id="rowMenu" class="menu">
    <button data-act="done"><span>‚úÖ</span> Marcar como completado</button>
    <button data-act="edit"><span>‚úèÔ∏è</span> Editar</button>
    <button data-act="dup"><span>üß¨</span> Duplicar</button>
    <button data-act="del" style="color:#ef4444"><span>üóëÔ∏è</span> Eliminar</button>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <header>
        <h3 id="modalTitle">Nuevo recordatorio</h3>
        <button class="btn" id="closeModal" title="Cerrar">‚úï</button>
      </header>
      <div class="content">
        <div class="field full">
          <label for="mTitle">T√≠tulo</label>
          <input id="mTitle" type="text" placeholder="Ej. Pagar a √Ålvaro"/>
        </div>
        <div class="field">
          <label for="mWhen">Fecha y hora</label>
          <input id="mWhen" type="datetime-local"/>
        </div>
        <div class="field">
          <label for="mRec">Recurrencia</label>
          <select id="mRec">
            <option value="once">Una vez</option>
            <option value="daily">Diaria</option>
            <option value="weekly">Semanal</option>
            <option value="monthly">Mensual</option>
            <option value="yearly">Anual</option>
          </select>
        </div>
        <div class="field full">
          <label for="mDesc">Descripci√≥n</label>
          <textarea id="mDesc" placeholder="Notas o detalles‚Ä¶"></textarea>
        </div>
      </div>
      <footer>
        <button class="btn" id="cancelModal">Cancelar</button>
        <button class="btn primary" id="saveModal">Guardar</button>
      </footer>
    </div>
  </div>

  <div id="toast" class="toast">Guardado</div>

<script>
/* ---------- Polyfill UUID (por si el entorno no lo trae) ---------- */
(function(){
  if (!('crypto' in window) || !crypto.randomUUID) {
    window.crypto = window.crypto || {};
    crypto.randomUUID = function(){
      const hex = [...crypto.getRandomValues(new Uint8Array(16))].map(b=>b.toString(16).padStart(2,'0'));
      hex[6] = (parseInt(hex[6],16) & 0x0f | 0x40).toString(16); // version 4
      hex[8] = (parseInt(hex[8],16) & 0x3f | 0x80).toString(16); // variant
      return `${hex.slice(0,4).join('')}-${hex.slice(4,6).join('')}-${hex.slice(6,8).join('')}-${hex.slice(8,10).join('')}-${hex.slice(10,16).join('')}`;
    };
  }
})();

/* ---------- Helpers ---------- */
const $ = (q, el=document) => el.querySelector(q);
const fmtDate = (iso) => {
  if(!iso) return '‚Äî';
  const d = new Date(iso);
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const yyyy = d.getFullYear();
  const hh = String(d.getHours()).padStart(2,'0');
  const mi = String(d.getMinutes()).padStart(2,'0');
  return `${dd}/${mm}/${yyyy} ${hh}:${mi}`;
};
const nextFrom = (iso, rec) => {
  if(rec === 'once') return iso;
  let d = new Date(iso);
  const now = new Date();
  while(d < now){
    if(rec==='daily') d.setDate(d.getDate()+1);
    else if(rec==='weekly') d.setDate(d.getDate()+7);
    else if(rec==='monthly') d.setMonth(d.getMonth()+1);
    else if(rec==='yearly') d.setFullYear(d.getFullYear()+1);
  }
  return d.toISOString();
};
const toast = (msg='Guardado')=>{
  const t = $('#toast'); t.textContent = msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),1600);
};

/* ---------- Estado ---------- */
const STORAGE_KEY = 'cm_reminders_v1';
let state = { rows:10, page:1, data:[] };
const saveAll = ()=>localStorage.setItem(STORAGE_KEY, JSON.stringify(state.data));
const loadAll = ()=>{
  try{
    const s = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    if(Array.isArray(s)) state.data = s;
  }catch(e){}
  if(state.data.length===0){
    state.data = [
      {id:crypto.randomUUID(), title:'Pagar a √Ålvaro', when:'2025-11-10T12:00', rec:'once', desc:'Transferencia bancaria', done:false},
      {id:crypto.randomUUID(), title:'Visa personal', when:'2025-12-01T12:00', rec:'monthly', desc:'Pagar tarjeta', done:false},
    ];
    saveAll();
  }
};

/* ---------- Render ---------- */
const tbody = $('#tbody');
const range = $('#range');
const pageLabel = $('#pageLabel');
function sortedList(){
  return [...state.data].sort((a,b)=> new Date(nextFrom(a.when,a.rec)) - new Date(nextFrom(b.when,b.rec)));
}
function render(){
  const all = sortedList();
  const total = all.length;
  const pages = Math.max(1, Math.ceil(total / state.rows));
  if(state.page>pages) state.page = pages;
  const start = (state.page-1)*state.rows;
  const current = all.slice(start, start + state.rows);
  tbody.innerHTML = current.map(row=>{
    const nextIso = nextFrom(row.when, row.rec);
    const freqLabel = ({once:'‚Äî',daily:'Diaria',weekly:'Semanal',monthly:'Mensual',yearly:'Anual'})[row.rec] || '‚Äî';
    const freqHtml = row.rec==='once'
      ? `<div class="muted">${fmtDate(row.when)}</div>`
      : `<div class="freq"><a href="#" data-void="1">${freqLabel}</a><div class="muted">${fmtDate(nextIso)}</div></div>`;
    return `
      <tr data-id="${row.id}">
        <td class="titleCell">${row.title}</td>
        <td>${freqHtml}</td>
        <td><div class="complete-box ${row.done?'done':''}" role="checkbox" aria-checked="${row.done}"><span class="checkmark">‚úì</span></div></td>
        <td class="muted">${row.desc?row.desc:'‚Äî'}</td>
        <td style="text-align:right;"><button class="ellipsis" aria-haspopup="menu" title="Acciones">‚ãØ</button></td>
      </tr>`;
  }).join('');
  const from = total? start+1 : 0;
  const to = Math.min(total, start + current.length);
  range.textContent = `${from}-${to} / ${total}`;
  pageLabel.textContent = `${state.page} / ${Math.max(1,Math.ceil(total/state.rows))}`;
  $('#first').disabled = $('#prev').disabled = state.page<=1;
  $('#next').disabled = $('#last').disabled = state.page>=Math.ceil(total/state.rows);
}

/* ---------- Interacci√≥n tabla ---------- */
let openMenuFor = null;
tbody.addEventListener('click', (e)=>{
  const rowEl = e.target.closest('tr'); if(!rowEl) return;
  const id = rowEl.dataset.id;
  if(e.target.closest('.complete-box')){
    const r = state.data.find(x=>x.id===id);
    r.done = !r.done; saveAll(); render(); return;
  }
  if(e.target.closest('.ellipsis')){
    const menu = $('#rowMenu'); openMenuFor = id;
    const rect = e.target.closest('.ellipsis').getBoundingClientRect();
    menu.style.left = `${rect.left - 180 + window.scrollX}px`;
    menu.style.top  = `${rect.bottom + 6 + window.scrollY}px`;
    menu.classList.add('open');
  }
});
document.addEventListener('click', (e)=>{
  if(!e.target.closest('.ellipsis') && !e.target.closest('#rowMenu')){
    $('#rowMenu').classList.remove('open');
  }
});
$('#rowMenu').addEventListener('click', (e)=>{
  const btn = e.target.closest('button'); if(!btn) return;
  const act = btn.dataset.act;
  const r = state.data.find(x=>x.id===openMenuFor); if(!r) return;
  if(act==='done'){ r.done = !r.done; saveAll(); render(); }
  if(act==='edit'){ openModal(r); }
  if(act==='dup'){ state.data.push({...r, id:crypto.randomUUID(), title:`${r.title} (copia)`, done:false}); saveAll(); render(); toast('Duplicado'); }
  if(act==='del' && confirm('¬øEliminar este recordatorio?')){ state.data = state.data.filter(x=>x.id!==r.id); saveAll(); render(); toast('Eliminado'); }
  $('#rowMenu').classList.remove('open');
});

/* ---------- Paginaci√≥n ---------- */
$('#rows').addEventListener('change', (e)=>{ state.rows = +e.target.value; state.page=1; render(); });
$('#first').onclick = ()=>{ state.page=1; render(); };
$('#prev').onclick  = ()=>{ state.page=Math.max(1,state.page-1); render(); };
$('#next').onclick  = ()=>{ state.page=state.page+1; render(); };
$('#last').onclick  = ()=>{
  const total = sortedList().length;
  const pages = Math.max(1, Math.ceil(total / state.rows));
  state.page = pages; render();
};

/* ---------- Modal CRUD ---------- */
const modalWrap = $('#modalWrap');
const mTitle = $('#mTitle');
const mWhen  = $('#mWhen');
const mRec   = $('#mRec');
const mDesc  = $('#mDesc');
let editingId = null;

function openModal(row=null){
  editingId = row? row.id : null;
  $('#modalTitle').textContent = editingId? 'Editar recordatorio' : 'Nuevo recordatorio';
  mTitle.value = row?.title || '';
  mWhen.value  = row?.when ? row.when.slice(0,16) : new Date(Date.now()+60*60*1000).toISOString().slice(0,16);
  mRec.value   = row?.rec || 'once';
  mDesc.value  = row?.desc || '';
  modalWrap.style.display='flex';
  setTimeout(()=>mTitle.focus(), 50);
}
function closeModal(){ modalWrap.style.display='none'; }

$('#btnNew').addEventListener('click', ()=>openModal());
$('#closeModal').addEventListener('click', closeModal);
$('#cancelModal').addEventListener('click', closeModal);
modalWrap.addEventListener('click', (e)=>{ if(e.target===modalWrap) closeModal(); });

$('#saveModal').addEventListener('click', ()=>{
  const title = mTitle.value.trim();
  const when  = mWhen.value;
  const rec   = mRec.value;
  const desc  = mDesc.value.trim();
  if(!title){ alert('Escribe un t√≠tulo'); mTitle.focus(); return; }
  if(!when){ alert('Selecciona fecha y hora'); mWhen.focus(); return; }
  if(editingId){
    const r = state.data.find(x=>x.id===editingId);
    Object.assign(r, {title, when, rec, desc});
    toast('Actualizado');
  }else{
    state.data.unshift({id:crypto.randomUUID(), title, when, rec, desc, done:false});
    toast('Guardado');
  }
  saveAll(); render(); closeModal();
});

/* ---------- Start ---------- */
loadAll();
render();
</script>
</body>
</html>
