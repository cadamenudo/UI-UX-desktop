<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Presupuesto – Montos seleccionados</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Nunito -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root {
      --cm-primary: #3956e8;
      --cm-secondary: #7459d9;
      --cm-bg: #f5f6ff;
      --cm-card-bg: #ffffff;
      --cm-text: #0f172a;
      --cm-muted: #64748b;
      --cm-border: #e5e7eb;
      --radius-card: 16px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--cm-bg);
      color: var(--cm-text);
    }

    .cm-page {
      padding: 24px 32px 32px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    .cm-page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .cm-page-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cm-breadcrumb {
      font-size: 0.8rem;
      color: var(--cm-muted);
    }

    .cm-page-title h1 {
      font-size: 1.8rem;
      font-weight: 800;
    }

    .cm-page-subtitle {
      font-size: 0.9rem;
      color: var(--cm-muted);
      margin-top: 4px;
    }

    .cm-page-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .cm-segment {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: #eef2ff;
      gap: 4px;
    }

    .cm-segment button {
      border: none;
      background: transparent;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.9rem;
      color: var(--cm-muted);
      cursor: pointer;
    }

    .cm-segment button.active {
      background: #ffffff;
      color: var(--cm-primary);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(148, 163, 184, 0.4);
    }

    .cm-select-inline {
      border-radius: 999px;
      border: 1px solid var(--cm-border);
      background: #fff;
      padding: 6px 12px;
      font-size: 0.9rem;
      color: var(--cm-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      min-width: 140px;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.04);
    }

    /* Card base */
    .cm-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 18px 20px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 18px;
    }

    .cm-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 8px;
    }

    .cm-card-title {
      font-size: 1rem;
      font-weight: 700;
    }

    /* Layout central */
    .cm-main-row {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.2fr);
      gap: 18px;
      margin-top: 8px;
    }

    /* Secciones tabla */
    .cm-section-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--cm-muted);
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .cm-section-row td {
      background: #f9fafb;
      border-bottom: none;
      padding-top: 10px;
      padding-bottom: 4px;
    }

    .cm-table-wrapper {
      border-radius: 12px;
      border: 1px solid var(--cm-border);
      overflow: auto;
      max-height: 460px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    thead {
      background: #f4f4ff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th, td {
      padding: 7px 9px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
      white-space: nowrap;
    }

    th {
      font-weight: 700;
      color: var(--cm-muted);
      font-size: 0.8rem;
    }

    tbody tr:nth-child(even) {
      background: #fafafa;
    }

    .cm-input-table-money {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 8px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #fff;
      min-width: 120px;
    }

    .cm-input-table-money span {
      font-size: 0.8rem;
      color: var(--cm-muted);
    }

    .cm-input-table-money input {
      border: none;
      outline: none;
      width: 80px;
      text-align: right;
      font-size: 0.85rem;
      background: transparent;
      font-family: inherit;
    }

    /* Panel derecho */
    .cm-side-panel {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .cm-side-box {
      background: #f9fafb;
      border-radius: 14px;
      padding: 12px 14px;
      border: 1px solid #e5e7eb;
      font-size: 0.85rem;
    }

    .cm-side-box h3 {
      margin-bottom: 6px;
      font-size: 0.9rem;
      font-weight: 700;
    }

    .cm-side-list {
      margin-left: 16px;
      margin-top: 4px;
      color: var(--cm-muted);
    }

    .cm-totals-list li {
      margin-bottom: 2px;
    }

    /* Dona gastos */
    .cm-donut-wrapper {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: flex-start;
      margin-top: 6px;
    }

    .cm-donut {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #e5e7eb;
      position: relative;
    }

    .cm-donut::after {
      content: "";
      position: absolute;
      inset: 24%;
      background: #f9fafb;
      border-radius: 50%;
    }

    .cm-donut-center {
      position: absolute;
      inset: 36%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--cm-text);
      text-align: center;
      z-index: 1;
    }

    .cm-donut-legend {
      font-size: 0.75rem;
      color: var(--cm-muted);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cm-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      display: inline-block;
      margin-right: 6px;
    }

    /* Botón guardar */
    .cm-actions-row {
      margin-top: 18px;
      display: flex;
      justify-content: flex-end;
    }

    .cm-btn-primary {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--cm-primary), var(--cm-secondary));
      color: #ffffff;
      font-size: 0.95rem;
      padding: 10px 24px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(55, 65, 81, 0.25);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .cm-btn-primary:hover {
      opacity: 0.95;
      transform: translateY(-1px);
    }

    /* Responsivo */
    @media (max-width: 1024px) {
      .cm-main-row {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 768px) {
      .cm-page {
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <main class="cm-page">
    <!-- Header -->
    <header class="cm-page-header">
      <div class="cm-page-title">
        <span class="cm-breadcrumb">Tablero / Presupuesto</span>
        <h1>Montos del presupuesto</h1>
        <p class="cm-page-subtitle">Ingresos, gastos y ahorros elegidos.</p>
      </div>

      <div class="cm-page-controls">
        <div class="cm-segment">
          <button class="active" type="button">Mensual</button>
          <button type="button">Anual</button>
        </div>
        <div class="cm-select-inline">
          <span>Periodo:</span> <strong>Enero 2025</strong> ⌄
        </div>
      </div>
    </header>

    <!-- Layout principal -->
    <section class="cm-main-row">
      <!-- Tabla montos -->
      <article class="cm-card">
        <header class="cm-card-header">
          <div>
            <div class="cm-card-title">Montos por grupo</div>
          </div>
        </header>

        <div class="cm-table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Presupuesto</th>
              </tr>
            </thead>
            <tbody id="tbodyIngresos">
              <!-- Ingresos -->
            </tbody>
            <tbody id="tbodyGastos">
              <!-- Gastos -->
            </tbody>
            <tbody id="tbodyAhorros">
              <!-- Ahorros -->
            </tbody>
          </table>
        </div>
      </article>

      <!-- Panel derecho -->
      <aside class="cm-side-panel">
        <div class="cm-side-box">
          <h3>Totales</h3>
          <ul class="cm-side-list cm-totals-list" id="listaTotales">
            <li>Ingresos: <strong>$0.00</strong></li>
            <li>Gastos: <strong>$0.00</strong></li>
            <li>Ahorro: <strong>$0.00</strong></li>
            <li>Balance: <strong>$0.00</strong></li>
          </ul>
        </div>

        <div class="cm-side-box">
          <h3>Gastos por categoría</h3>
          <div class="cm-donut-wrapper">
            <div class="cm-donut" id="donutGastos">
              <div class="cm-donut-center" id="donutCentro">$0</div>
            </div>
            <div class="cm-donut-legend" id="legendGastos">
              Sin datos.
            </div>
          </div>
        </div>
      </aside>
    </section>

    <!-- Botón -->
    <div class="cm-actions-row">
      <button class="cm-btn-primary" type="button">
        Guardar presupuesto
      </button>
    </div>
  </main>

  <script>
    // Aquí después se pueden inyectar las categorías "elegidas" desde la primera página.
    // Por ahora dejo ejemplos básicos.
    const ingresos = [
      { nombre: 'Ingreso principal' },
      { nombre: 'Ingreso variable' },
      { nombre: 'Otros ingresos' }
    ];

    const gastos = [
      { nombre: 'Vivienda' },
      { nombre: 'Alimentación' },
      { nombre: 'Transporte' },
      { nombre: 'Salud' },
      { nombre: 'Deuda' },
      { nombre: 'Servicios' },
      { nombre: 'Ocio' },
      { nombre: 'Comidas fuera' },
      { nombre: 'Compras' },
      { nombre: 'Otros gastos' }
    ];

    const ahorros = [
      { nombre: 'Emergencia' },
      { nombre: 'Metas' },
      { nombre: 'Inversión / retiro' }
    ];

    const coloresGastos = [
      '#3956E8',
      '#7459D9',
      '#E8C239',
      '#22C55E',
      '#F97316',
      '#EC4899',
      '#0EA5E9',
      '#A855F7'
    ];

    function formatearMoneda(valor) {
      const n = Number(valor) || 0;
      return n.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
    }

    function crearFila(nombre, grupo, tbody) {
      const tr = document.createElement('tr');

      const tdNombre = document.createElement('td');
      tdNombre.textContent = nombre;

      const tdMonto = document.createElement('td');
      const wrapperMonto = document.createElement('div');
      wrapperMonto.className = 'cm-input-table-money';
      const simbolo = document.createElement('span');
      simbolo.textContent = '$';
      const input = document.createElement('input');
      input.type = 'number';
      input.min = '0';
      input.step = '0.01';
      input.placeholder = '0.00';
      input.dataset.grupo = grupo;
      input.dataset.categoria = nombre;
      input.oninput = recalcularPresupuesto;
      wrapperMonto.appendChild(simbolo);
      wrapperMonto.appendChild(input);
      tdMonto.appendChild(wrapperMonto);

      tr.appendChild(tdNombre);
      tr.appendChild(tdMonto);

      tbody.appendChild(tr);
    }

    function inicializarTabla() {
      const tbodyIngresos = document.getElementById('tbodyIngresos');
      const tbodyGastos = document.getElementById('tbodyGastos');
      const tbodyAhorros = document.getElementById('tbodyAhorros');

      // Fila título Ingresos
      const filaTituloIng = document.createElement('tr');
      filaTituloIng.className = 'cm-section-row';
      const celIng = document.createElement('td');
      celIng.colSpan = 2;
      celIng.innerHTML = '<span class="cm-section-title">Ingresos elegidos</span>';
      filaTituloIng.appendChild(celIng);
      tbodyIngresos.appendChild(filaTituloIng);
      ingresos.forEach(i => crearFila(i.nombre, 'ingreso', tbodyIngresos));

      // Fila título Gastos
      const filaTituloGas = document.createElement('tr');
      filaTituloGas.className = 'cm-section-row';
      const celGas = document.createElement('td');
      celGas.colSpan = 2;
      celGas.innerHTML = '<span class="cm-section-title">Gastos elegidos</span>';
      filaTituloGas.appendChild(celGas);
      tbodyGastos.appendChild(filaTituloGas);
      gastos.forEach(g => crearFila(g.nombre, 'gasto', tbodyGastos));

      // Fila título Ahorros
      const filaTituloAho = document.createElement('tr');
      filaTituloAho.className = 'cm-section-row';
      const celAho = document.createElement('td');
      celAho.colSpan = 2;
      celAho.innerHTML = '<span class="cm-section-title">Ahorros elegidos</span>';
      filaTituloAho.appendChild(celAho);
      tbodyAhorros.appendChild(filaTituloAho);
      ahorros.forEach(a => crearFila(a.nombre, 'ahorro', tbodyAhorros));
    }

    function actualizarDonaGastos(mapaGastos) {
      const donut = document.getElementById('donutGastos');
      const centro = document.getElementById('donutCentro');
      const legend = document.getElementById('legendGastos');

      const entradas = Object.entries(mapaGastos).filter(([_, v]) => v > 0);
      const total = entradas.reduce((acc, [, v]) => acc + v, 0);

      centro.textContent = total > 0 ? formatearMoneda(total) : '$0';

      if (total === 0 || entradas.length === 0) {
        donut.style.background = '#e5e7eb';
        legend.textContent = 'Sin datos.';
        return;
      }

      let actual = 0;
      const partes = [];
      const leyendaHtml = [];

      entradas.forEach(([nombre, valor], idx) => {
        const color = coloresGastos[idx % coloresGastos.length];
        const grados = (valor / total) * 360;
        const inicio = actual;
        const fin = actual + grados;
        partes.push(`${color} ${inicio}deg ${fin}deg`);
        actual = fin;

        const porcentaje = ((valor / total) * 100).toFixed(0);
        leyendaHtml.push(
          `<div><span class="cm-dot" style="background:${color}"></span>${nombre} – ${porcentaje}%</div>`
        );
      });

      donut.style.background = `conic-gradient(${partes.join(',')})`;
      legend.innerHTML = leyendaHtml.join('');
    }

    function recalcularPresupuesto() {
      const inputs = document.querySelectorAll('.cm-input-table-money input');

      let totalIngreso = 0;
      let totalGasto = 0;
      let totalAhorro = 0;
      const gastosPorCategoria = {};

      inputs.forEach(input => {
        const val = parseFloat(input.value) || 0;
        const grupo = input.dataset.grupo;
        const categoria = input.dataset.categoria;

        if (grupo === 'ingreso') totalIngreso += val;
        if (grupo === 'gasto') {
          totalGasto += val;
          gastosPorCategoria[categoria] = (gastosPorCategoria[categoria] || 0) + val;
        }
        if (grupo === 'ahorro') totalAhorro += val;
      });

      const totalUso = totalGasto + totalAhorro;
      const balance = totalIngreso - totalUso;

      // Totales panel derecho
      const listaTotales = document.getElementById('listaTotales');
      listaTotales.innerHTML = `
        <li>Ingresos: <strong>${formatearMoneda(totalIngreso)}</strong></li>
        <li>Gastos: <strong>${formatearMoneda(totalGasto)}</strong></li>
        <li>Ahorro: <strong>${formatearMoneda(totalAhorro)}</strong></li>
        <li>Balance: <strong>${formatearMoneda(balance)}</strong></li>
      `;

      // Dona gastos
      actualizarDonaGastos(gastosPorCategoria);
    }

    document.addEventListener('DOMContentLoaded', () => {
      inicializarTabla();
      recalcularPresupuesto();
    });
  </script>
</body>
</html>
