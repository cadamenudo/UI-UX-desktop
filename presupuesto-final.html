<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Flujo completo de presupuesto – Cada Menudo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Nunito -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --cm-primary: #3956e8;
      --cm-secondary: #7459d9;
      --cm-bg: #f5f6ff;
      --cm-card-bg: #ffffff;
      --cm-text: #0f172a;
      --cm-muted: #64748b;
      --cm-border: #e5e7eb;
      --cm-success-bg: #ecfdf3;
      --cm-success-text: #15803d;
      --cm-warning-bg: #fef9c3;
      --cm-warning-text: #92400e;
      --cm-danger-bg: #fef2f2;
      --cm-danger-text: #b91c1c;
      --radius-card: 16px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--cm-bg);
      color: var(--cm-text);
    }

    .cm-page {
      padding: 24px 32px 32px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    .cm-page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .cm-page-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cm-breadcrumb {
      font-size: 0.8rem;
      color: var(--cm-muted);
    }

    .cm-page-title h1 {
      font-size: 1.7rem;
      font-weight: 800;
    }

    .cm-page-subtitle {
      font-size: 0.95rem;
      color: var(--cm-muted);
      margin-top: 4px;
    }

    .cm-page-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .cm-select-inline,
    .cm-select {
      border-radius: 999px;
      border: 1px solid var(--cm-border);
      background: #fff;
      padding: 6px 12px;
      font-size: 0.9rem;
      color: var(--cm-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.04);
    }

    .cm-select-inline select {
      border: none;
      background: transparent;
      font: inherit;
      color: inherit;
      outline: none;
      cursor: pointer;
    }

    /* Tabs */
    .cm-tabs {
      display: inline-flex;
      margin: 8px 0 18px 0;
      border-radius: 999px;
      background: #e5e7eb;
      padding: 3px;
      box-shadow: 0 2px 8px rgba(15,23,42,0.08);
    }

    .cm-tab {
      border: none;
      background: transparent;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.85rem;
      color: #4b5563;
      cursor: pointer;
    }

    .cm-tab.active {
      background: #ffffff;
      color: var(--cm-primary);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(148,163,184,0.4);
    }

    /* Generic card */
    .cm-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 16px 18px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 18px;
    }

    .cm-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .cm-card-title {
      font-size: 1rem;
      font-weight: 700;
    }

    .cm-card-subtitle {
      font-size: 0.85rem;
      color: var(--cm-muted);
      margin-top: 2px;
    }

    /* Toggle mensual/anual */
    .cm-segment {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: #eef2ff;
      gap: 4px;
      margin-top: 6px;
    }

    .cm-segment button {
      border: none;
      background: transparent;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.9rem;
      color: var(--cm-muted);
      cursor: pointer;
    }

    .cm-segment button.active {
      background: #ffffff;
      color: var(--cm-primary);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(148,163,184,0.4);
    }

    .cm-type-row {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .cm-helper-text {
      font-size: 0.8rem;
      color: var(--cm-muted);
      margin-top: 6px;
    }

    .cm-highlight {
      color: var(--cm-primary);
      font-weight: 600;
    }

    /* Views */
    .cm-view { display: none; }
    .cm-view.active { display: block; }

    /* === Estilos de categorías (como tu componente) === */
    .seccion-categorias {
      margin-top: 0.5rem;
    }

    .titulo-categorias {
      font-size: 1.1rem;
      font-weight: 700;
      color: #111827;
      margin: 0.5rem 0 1rem 0;
      padding-left: 0.25rem;
    }

    .bloque-sector {
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
      margin: 0 auto 1.2rem;
      max-width: 100%;
    }

    .encabezado {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.75rem;
      font-size: 1.05rem;
      font-weight: bold;
      padding: 1.1rem 1rem;
      cursor: pointer;
    }

    .icono-ingresos,
    .icono-gastos,
    .icono-ahorro {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: 32px;
      background-repeat: no-repeat;
      background-position: center;
    }

    .icono-ingresos {
      background-color: #F4F2FF;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/ingreso.png');
    }

    .icono-gastos {
      background-color: #F3F4F6;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/gastos.png');
    }

    .icono-ahorro {
      background-color: #FCFAEA;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/ahorro.png');
    }

    .contenido-bloque {
      display: none;
      padding: 1rem 2rem;
    }

    .bloque-sector.abierto .contenido-bloque {
      display: block;
    }

    .bloque-categoria {
      background: #fff;
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 1rem;
    }

    .titulo-categoria {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
    }

    .subcategorias {
      margin-top: 0.75rem;
      padding-left: 1rem;
      display: none;
    }

    .subcategorias.activo { display: block; }

    .fila {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #4F46E5;
    }

    input:checked + .slider:before {
      transform: translateX(20px);
    }

    .acciones {
      margin-top: 1rem;
      text-align: right;
    }

    .acciones button {
      background: #7459D9;
      color: white;
      border: none;
      padding: 0.4rem 0.75rem;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      margin-left: 0.5rem;
    }

    .editable-span { cursor: pointer; }

    .editable-input {
      font-family: inherit;
      font-size: 1rem;
      padding: 2px 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .pildora-recurrencia {
      background: #ECFDF3;
      color: #00AC4F;
      font-size: 0.75rem;
      font-weight: 500;
      border-radius: 999px;
      padding: 0.15rem 0.5rem;
      margin-left: 0.4rem;
      display: inline-block;
    }

    /* Modal */
    .modal-subcategoria {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(17, 24, 39, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-subcategoria.abierto { display: flex; }

    .modal-contenido {
      background: #fff;
      border-radius: 16px;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .modal-contenido h3 {
      margin-top: 0;
      font-size: 1.25rem;
      color: #111827;
      font-weight: bold;
      margin-bottom: 1.5rem;
    }

    .modal-contenido label {
      display: block;
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
      margin-top: 1rem;
      color: #111827;
    }

    .modal-contenido input,
    .modal-contenido select,
    .modal-contenido textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #D1D5DB;
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      box-sizing: border-box;
      margin-bottom: 0.5rem;
    }

    .modal-contenido textarea {
      resize: vertical;
      min-height: 60px;
    }

    .modal-botones {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 2rem;
    }

    .modal-botones .cancelar {
      background: #F8F6FF !important;
      color: #4B0082 !important;
      padding: 0.75rem 1.5rem !important;
      font-size: 1rem !important;
      font-weight: 600 !important;
      border: none !important;
      border-radius: 8px !important;
      cursor: pointer !important;
    }

    .modal-botones .guardar {
      background: #3956E8 !important;
      color: white !important;
      padding: 0.75rem 1.5rem !important;
      font-size: 1rem !important;
      font-weight: 600 !important;
      border: none !important;
      border-radius: 8px !important;
      cursor: pointer !important;
    }

    /* ====== PÁGINA MONTOS ====== */

    .cm-grid-montos {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.3fr);
      gap: 16px;
      margin-top: 8px;
    }

    .cm-col-block {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .cm-section-title {
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--cm-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .cm-table-simple {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .cm-table-simple th,
    .cm-table-simple td {
      padding: 6px 2px;
      text-align: left;
    }

    .cm-table-simple th {
      font-weight: 700;
      color: var(--cm-muted);
      font-size: 0.78rem;
    }

    .cm-input-money {
      width: 100%;
      max-width: 110px;
      border-radius: 999px;
      border: 1px solid var(--cm-border);
      padding: 4px 10px;
      font-size: 0.85rem;
      text-align: right;
    }

    .cm-totals-card {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .cm-total-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }

    .cm-total-row span:last-child {
      font-weight: 800;
    }

    .cm-total-label {
      color: var(--cm-muted);
    }

    .cm-total-saldo {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px dashed var(--cm-border);
    }

    .cm-donut-card {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }

    #chartGastos {
      max-width: 240px;
      max-height: 240px;
    }

    .cm-btn-primary {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--cm-primary), var(--cm-secondary));
      color: #ffffff;
      font-size: 0.95rem;
      padding: 10px 24px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(55, 65, 81, 0.25);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .cm-btn-primary:hover {
      opacity: 0.97;
      transform: translateY(-1px);
    }

    .cm-actions-row {
      margin-top: 14px;
      display: flex;
      justify-content: flex-end;
    }

    /* ====== PÁGINA VS REAL ====== */

    .cm-banner {
      margin-top: 8px;
      margin-bottom: 20px;
      padding: 12px 16px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: var(--shadow-soft);
      background: var(--cm-success-bg);
      color: var(--cm-success-text);
      font-size: 0.95rem;
    }

    .cm-banner strong {
      font-weight: 800;
    }

    .cm-banner span.cm-banner-secondary {
      color: var(--cm-muted);
    }

    .cm-kpi-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .cm-kpi-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 16px 18px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cm-kpi-label {
      font-size: 0.85rem;
      color: var(--cm-muted);
    }

    .cm-kpi-value {
      font-size: 1.5rem;
      font-weight: 800;
    }

    .cm-kpi-sub {
      font-size: 0.85rem;
      color: var(--cm-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cm-chip-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: rgba(34, 197, 94, 0.08);
      color: #15803d;
    }

    .cm-main-row {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    #chartVsReal {
      width: 100%;
      max-height: 260px;
    }

    .cm-category-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
      margin-bottom: 12px;
    }

    .cm-category-item {
      border-radius: 10px;
      border: 1px solid var(--cm-border);
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cm-category-top {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
    }

    .cm-category-name {
      font-weight: 600;
    }

    .cm-category-amounts {
      color: var(--cm-muted);
      font-size: 0.8rem;
    }

    .cm-category-bar {
      position: relative;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .cm-category-bar-fill {
      position: absolute;
      inset: 0;
      width: 70%;
      background: linear-gradient(90deg, var(--cm-primary), var(--cm-secondary));
    }

    .cm-badge {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
    }

    .cm-badge.green {
      background: rgba(34, 197, 94, 0.08);
      color: #15803d;
    }

    .cm-badge.yellow {
      background: rgba(234, 179, 8, 0.08);
      color: #92400e;
    }

    .cm-badge.red {
      background: rgba(239, 68, 68, 0.08);
      color: #b91c1c;
    }

    .cm-table-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 16px 18px 12px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 20px;
    }

    .cm-table-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .cm-table-card-header h2 {
      font-size: 1rem;
      font-weight: 700;
    }

    .cm-table-wrapper {
      border-radius: 12px;
      border: 1px solid var(--cm-border);
      overflow: auto;
      max-height: 320px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    thead {
      background: #f4f4ff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th, td {
      padding: 8px 10px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
      white-space: nowrap;
    }

    th {
      font-weight: 700;
      color: var(--cm-muted);
      font-size: 0.8rem;
    }

    tbody tr:nth-child(even) {
      background: #fafafa;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .cm-grid-montos,
      .cm-main-row {
        grid-template-columns: minmax(0, 1fr);
      }
      .cm-kpi-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 768px) {
      .cm-page { padding: 16px; }
      .cm-kpi-row { grid-template-columns: minmax(0, 1fr); }
      .cm-page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
<main class="cm-page">
  <!-- Header global -->
  <header class="cm-page-header">
    <div class="cm-page-title">
      <span class="cm-breadcrumb">Tablero / Presupuesto</span>
      <h1>Presupuesto</h1>
      <p class="cm-page-subtitle">Configura tu presupuesto, asigna montos y compara con tu gasto real.</p>
    </div>

    <div class="cm-page-controls">
      <div class="cm-toggle cm-segment" id="toggleTipo">
        <button class="active" type="button" data-tipo="mensual">Mensual</button>
        <button type="button" data-tipo="anual">Anual</button>
      </div>
      <div class="cm-select-inline" id="selectorPeriodo">
        <span>Mes:</span> <strong>Enero 2025</strong> ⌄
      </div>
    </div>
  </header>

  <!-- Tabs -->
  <div class="cm-tabs">
    <button class="cm-tab active" data-view="inicio">1. Configurar</button>
    <button class="cm-tab" data-view="montos">2. Montos</button>
    <button class="cm-tab" data-view="vsreal">3. Vs real</button>
  </div>

  <!-- =================== VIEW 1: INICIO =================== -->
  <section id="view-inicio" class="cm-view active">
    <!-- Tipo presupuesto -->
    <section class="cm-card">
      <div class="cm-card-header">
        <div>
          <div class="cm-card-title">Tipo de presupuesto</div>
          <div class="cm-card-subtitle">Mes a mes o todo el año.</div>
        </div>
      </div>

      <div class="cm-type-row">
        <div class="cm-segment" id="segmentTipoLocal">
          <button class="active" type="button" data-tipo="mensual">Mensual</button>
          <button type="button" data-tipo="anual">Anual</button>
        </div>

        <div class="cm-select-inline" id="selectorPeriodoLocal">
          <span>Mes:</span> <strong>Enero 2025</strong> ⌄
        </div>
      </div>

      <p class="cm-helper-text">
        Si eliges <span class="cm-highlight">mensual</span>, trabajas solo ese mes y luego puedes copiarlo o ajustarlo.
      </p>
    </section>

    <!-- Categorías -->
    <section class="cm-card">
      <div class="cm-card-header">
        <div>
          <div class="cm-card-title">Selecciona categorías</div>
          <div class="cm-card-subtitle">Activa las que quieres presupuestar.</div>
        </div>
      </div>

      <div class="cm-categories-wrapper">
        <section class="seccion-categorias">
          <h3 class="titulo-categorias">Lista de Categorías</h3>

          <!-- INGRESOS -->
          <div class="bloque-sector">
            <div class="encabezado" onclick="toggleBloque(this)">
              <div class="icono-ingresos"></div>
              <span>Ingresos</span>
            </div>
            <div class="contenido-bloque">

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Pago por trabajo</span>
                  <label class="switch">
                    <input type="checkbox" checked data-tipo="ingreso" data-categoria="Pago por trabajo">
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Salario"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Salario</span>
                    <label class="switch">
                      <input type="checkbox" checked data-tipo="ingreso" data-categoria="Salario">
                      <span class="slider"></span>
                    </label>
                  </div>
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Bono"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Bono</span>
                    <label class="switch">
                      <input type="checkbox" data-tipo="ingreso" data-categoria="Bono">
                      <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Negocio propio</span>
                  <label class="switch">
                    <input type="checkbox" data-tipo="ingreso" data-categoria="Negocio propio">
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Negocio propio"
                          data-recurrencia=""
                          data-monto=""
                          data-descripcion="">Negocio propio</span>
                    <label class="switch">
                      <input type="checkbox" data-tipo="ingreso" data-categoria="Negocio propio">
                      <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- GASTOS -->
          <div class="bloque-sector">
            <div class="encabezado" onclick="toggleBloque(this)">
              <div class="icono-gastos"></div>
              <span>Gastos</span>
            </div>
            <div class="contenido-bloque">
              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Vivienda</span>
                  <label class="switch">
                    <input type="checkbox" checked data-tipo="gasto" data-categoria="Vivienda">
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Hipoteca / Alquiler">Hipoteca / Alquiler</span>
                    <label class="switch">
                      <input type="checkbox" checked data-tipo="gasto" data-categoria="Vivienda">
                      <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Alimentación</span>
                  <label class="switch">
                    <input type="checkbox" checked data-tipo="gasto" data-categoria="Alimentación">
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Supermercado">Supermercado</span>
                    <label class="switch">
                      <input type="checkbox" checked data-tipo="gasto" data-categoria="Alimentación">
                      <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Transporte</span>
                  <label class="switch">
                    <input type="checkbox" checked data-tipo="gasto" data-categoria="Transporte">
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Transporte">Transporte</span>
                    <label class="switch">
                      <input type="checkbox" checked data-tipo="gasto" data-categoria="Transporte">
                      <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Ocio</span>
                  <label class="switch">
                    <input type="checkbox" data-tipo="gasto" data-categoria="Ocio">
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="subcategorias">
                  <div class="fila">
                    <span class="editable-span"
                          data-nombre="Ocio">Ocio</span>
                    <label class="switch">
                      <input type="checkbox" data-tipo="gasto" data-categoria="Ocio">
                      <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- AHORRO -->
          <div class="bloque-sector">
            <div class="encabezado" onclick="toggleBloque(this)">
              <div class="icono-ahorro"></div>
              <span>Ahorro</span>
            </div>
            <div class="contenido-bloque">
              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Fondo de emergencia</span>
                  <label class="switch">
                    <input type="checkbox" checked data-tipo="ahorro" data-categoria="Fondo de emergencia">
                    <span class="slider"></span>
                  </label>
                </div>
              </div>

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Inversión</span>
                  <label class="switch">
                    <input type="checkbox" checked data-tipo="ahorro" data-categoria="Inversión">
                    <span class="slider"></span>
                  </label>
                </div>
              </div>

              <div class="bloque-categoria">
                <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                  <span>Ahorro general</span>
                  <label class="switch">
                    <input type="checkbox" data-tipo="ahorro" data-categoria="Ahorro general">
                    <span class="slider"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <p class="cm-helper-text">
        Menos categorías activas = más fácil de seguir.
      </p>
    </section>

    <div class="cm-actions-row">
      <button class="cm-btn-primary" type="button" id="btnIrMontos">
        Continuar a montos ⟶
      </button>
    </div>
  </section>

  <!-- =================== VIEW 2: MONTOS =================== -->
  <section id="view-montos" class="cm-view">
    <section class="cm-card">
      <div class="cm-card-header">
        <div>
          <div class="cm-card-title">Asignar montos</div>
          <div class="cm-card-subtitle">Presupuesto para ingresos, gastos y ahorro.</div>
        </div>
      </div>

      <div class="cm-grid-montos">
        <!-- Columna izquierda: tablas -->
        <div class="cm-col-block">
          <div class="cm-card">
            <div class="cm-section-title">Ingresos</div>
            <table class="cm-table-simple" id="tablaIngresos">
              <thead>
              <tr>
                <th>Fuente</th>
                <th style="text-align:right;">Presupuesto</th>
              </tr>
              </thead>
              <tbody>
              <!-- Se rellena por JS -->
              </tbody>
            </table>
          </div>

          <div class="cm-card">
            <div class="cm-section-title">Gastos</div>
            <table class="cm-table-simple" id="tablaGastos">
              <thead>
              <tr>
                <th>Categoría</th>
                <th style="text-align:right;">Presupuesto</th>
              </tr>
              </thead>
              <tbody>
              <!-- JS -->
              </tbody>
            </table>
          </div>

          <div class="cm-card">
            <div class="cm-section-title">Ahorro</div>
            <table class="cm-table-simple" id="tablaAhorro">
              <thead>
              <tr>
                <th>Meta / Fondo</th>
                <th style="text-align:right;">Presupuesto</th>
              </tr>
              </thead>
              <tbody>
              <!-- JS -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Columna derecha: totales + dona -->
        <div class="cm-col-block">
          <div class="cm-card">
            <div class="cm-section-title">Totales</div>
            <div class="cm-totals-card">
              <div class="cm-total-row">
                <span class="cm-total-label">Total ingresos</span>
                <span id="totalIngresos">$0.00</span>
              </div>
              <div class="cm-total-row">
                <span class="cm-total-label">Total gastos</span>
                <span id="totalGastos">$0.00</span>
              </div>
              <div class="cm-total-row">
                <span class="cm-total-label">Total ahorro</span>
                <span id="totalAhorro">$0.00</span>
              </div>
              <div class="cm-total-row cm-total-saldo">
                <span class="cm-total-label">Saldo (ingresos − gastos − ahorro)</span>
                <span id="saldoPresupuesto">$0.00</span>
              </div>
            </div>
          </div>

          <div class="cm-card cm-donut-card">
            <div class="cm-section-title">Gastos por categoría</div>
            <canvas id="chartGastos"></canvas>
          </div>

          <div class="cm-actions-row">
            <button class="cm-btn-primary" type="button" id="btnGuardarIrVsReal">
              Guardar presupuesto y ver vs real ⟶
            </button>
          </div>
        </div>
      </div>
    </section>
  </section>

  <!-- =================== VIEW 3: VS REAL =================== -->
  <section id="view-vsreal" class="cm-view">
    <section class="cm-banner">
      <div>
        <strong>Estado del período:</strong>
        Estás usando el <strong id="porcUsoMes">0%</strong> de tu presupuesto.
      </div>
      <span class="cm-banner-secondary">
        Te quedan <strong id="montoDisponibleVs">$0.00</strong> para gastar/ahorrar.
      </span>
    </section>

    <section class="cm-kpi-row">
      <article class="cm-kpi-card">
        <span class="cm-kpi-label">Presupuesto (gastos + ahorro)</span>
        <div class="cm-kpi-value" id="kpiPresupuestoMes">$0.00</div>
        <div class="cm-kpi-sub">Monto total planeado para este período.</div>
      </article>

      <article class="cm-kpi-card">
        <span class="cm-kpi-label">Gasto/Ahorro real estimado</span>
        <div class="cm-kpi-value" id="kpiGastoReal">$0.00</div>
        <div class="cm-kpi-sub">Simulación de tus movimientos reales.</div>
      </article>

      <article class="cm-kpi-card">
        <span class="cm-kpi-label">Diferencia</span>
        <div class="cm-kpi-value" id="kpiDiferencia">$0.00</div>
        <div class="cm-kpi-sub">
          <span class="cm-chip-status">Dentro del presupuesto</span>
        </div>
      </article>
    </section>

    <section class="cm-main-row">
      <article class="cm-card">
        <header class="cm-card-header">
          <h2>Presupuesto vs real por categoría</h2>
          <div class="cm-select-inline">
            <span>Área:</span>
            <select id="selectAreaVsReal" class="cm-select-native">
              <option value="ingreso">Ingresos</option>
              <option value="gasto" selected>Gastos</option>
              <option value="ahorro">Ahorro</option>
            </select>
          </div>
        </header>
        <canvas id="chartVsReal"></canvas>
      </article>

      <article class="cm-card">
        <header class="cm-card-header">
          <h2>Categorías con más desvío</h2>
        </header>
        <div class="cm-category-list" id="listaDesvios">
          <!-- JS -->
        </div>
      </article>
    </section>

    <section class="cm-table-card">
      <header class="cm-table-card-header">
        <h2>Detalle por categoría</h2>
      </header>
      <div class="cm-table-wrapper">
        <table id="tablaVsReal">
          <thead>
          <tr>
            <th>Categoría</th>
            <th>Tipo</th>
            <th>Presupuesto</th>
            <th>Real (demo)</th>
            <th>Diferencia</th>
            <th>% usado</th>
          </tr>
          </thead>
          <tbody id="tbodyVsReal">
          <!-- JS -->
          </tbody>
        </table>
      </div>
    </section>
  </section>

  <!-- MODAL SUBCATEGORÍAS (compartido) -->
  <div id="modalSubcategoria" class="modal-subcategoria">
    <div class="modal-contenido">
      <h3>Subcategoría</h3>
      <label for="nombreSub">Nombre</label>
      <input type="text" id="nombreSub" placeholder="Ej. Comisión extra" />

      <label for="inputRecurrencia">Recurrencia</label>
      <select id="inputRecurrencia">
        <option value="">Ninguna</option>
        <option value="diario">Diario</option>
        <option value="semanal">Semanal</option>
        <option value="quincenal">Quincenal</option>
        <option value="mensual">Mensual</option>
        <option value="anual">Anual</option>
      </select>

      <div id="grupoMonto" style="display: none;">
        <label for="montoRecurrencia">Monto</label>
        <input type="number" id="montoRecurrencia" placeholder="$0.00" />
      </div>

      <label for="descripcion">Descripción (opcional)</label>
      <textarea id="descripcion" placeholder="Descripción breve..."></textarea>

      <div class="modal-botones">
        <button class="cancelar" type="button">Cancelar</button>
        <button class="guardar" type="button">Guardar</button>
      </div>
    </div>
  </div>
</main>

<script>
  /* ---------- ESTADO GLOBAL ---------- */
  let modoPeriodo = 'mensual'; // 'mensual' o 'anual'
  let filasUltimoCalculo = [];
  let chartGastos;
  let chartVsReal;

  /* ---------- UTILIDADES ---------- */
  function formatMoney(v) {
    const num = Number(v) || 0;
    return num.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
  }

  function toggleBloque(encabezado) {
    const parent = encabezado.closest('.bloque-sector');
    document.querySelectorAll('.bloque-sector').forEach(b => {
      if (b !== parent) b.classList.remove('abierto');
    });
    parent.classList.toggle('abierto');
  }

  function toggleSubcategorias(element) {
    const all = document.querySelectorAll('.subcategorias');
    all.forEach(sc => {
      if (sc !== element.nextElementSibling) sc.classList.remove('activo');
    });
    element.nextElementSibling.classList.toggle('activo');
  }

  /* ---------- TABS ---------- */
  const tabs = document.querySelectorAll('.cm-tab');
  const views = document.querySelectorAll('.cm-view');

  function mostrarVista(id) {
    views.forEach(v => v.classList.remove('active'));
    document.getElementById('view-' + id).classList.add('active');

    tabs.forEach(t => t.classList.remove('active'));
    document.querySelector('.cm-tab[data-view="' + id + '"]').classList.add('active');

    if (id === 'vsreal') {
      actualizarVsReal();
    }
  }

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const view = tab.dataset.view;
      mostrarVista(view);
    });
  });

  /* ---------- MODAL SUBCATEGORÍA ---------- */
  const modal = document.getElementById('modalSubcategoria');

  function abrirModalSubcategoria(textoInicial = '', callbackAceptar, datosPrevios = {}) {
    document.getElementById('nombreSub').value = textoInicial;
    document.getElementById('inputRecurrencia').value = datosPrevios.recurrencia || '';
    document.getElementById('montoRecurrencia').value = datosPrevios.monto || '';
    document.getElementById('descripcion').value = datosPrevios.descripcion || '';

    const grupoMonto = document.getElementById('grupoMonto');
    if (datosPrevios.recurrencia) {
      grupoMonto.style.display = 'block';
    } else {
      grupoMonto.style.display = 'none';
    }

    modal.classList.add('abierto');

    const aceptar = modal.querySelector('.guardar');
    const cancelar = modal.querySelector('.cancelar');

    const cerrar = () => {
      modal.classList.remove('abierto');
      aceptar.onclick = null;
      cancelar.onclick = null;
    };

    aceptar.onclick = () => {
      const nombre = document.getElementById('nombreSub').value.trim();
      const recurrencia = document.getElementById('inputRecurrencia').value;
      const monto = parseFloat(document.getElementById('montoRecurrencia').value) || null;
      const descripcion = document.getElementById('descripcion').value.trim();
      callbackAceptar({ nombre, recurrencia, monto, descripcion });
      cerrar();
    };

    cancelar.onclick = cerrar;
  }

  document.addEventListener('change', function (e) {
    if (e.target && e.target.id === 'inputRecurrencia') {
      const grupoMonto = document.getElementById('grupoMonto');
      const montoInput = document.getElementById('montoRecurrencia');
      const seleccion = e.target.value;

      if (!seleccion) {
        grupoMonto.style.display = 'none';
        montoInput.value = '';
      } else {
        grupoMonto.style.display = 'block';
      }
    }
  });

  /* ---------- CAPTURAR CATEGORÍAS ACTIVAS Y PASARLAS A MONTOS ---------- */

  function leerCategoriasActivas() {
    const checks = document.querySelectorAll('.contenido-bloque input[type="checkbox"]');
    const lista = [];

    checks.forEach(chk => {
      if (!chk.checked) return;
      const tipo = chk.dataset.tipo;
      const categoria = chk.dataset.categoria;
      if (!tipo || !categoria) return;

      // Evitar duplicados
      if (!lista.find(x => x.tipo === tipo && x.categoria === categoria)) {
        lista.push({ tipo, categoria });
      }
    });

    return lista;
  }

  const DEMO_PRESETS = {
    'Salario': 3000,
    'Bono': 200,
    'Negocio propio': 600,
    'Pago por trabajo': 0, // general, no lo usamos directo
    'Vivienda': 900,
    'Alimentación': 450,
    'Transporte': 120,
    'Ocio': 150,
    'Fondo de emergencia': 200,
    'Inversión': 150,
    'Ahorro general': 100
  };

  function construirTablasMontos(categorias) {
    const tIng = document.querySelector('#tablaIngresos tbody');
    const tGas = document.querySelector('#tablaGastos tbody');
    const tAho = document.querySelector('#tablaAhorro tbody');

    tIng.innerHTML = '';
    tGas.innerHTML = '';
    tAho.innerHTML = '';

    categorias.forEach(item => {
      const tr = document.createElement('tr');
      const tdNombre = document.createElement('td');
      tdNombre.textContent = item.categoria;

      const tdMonto = document.createElement('td');
      tdMonto.style.textAlign = 'right';

      const input = document.createElement('input');
      input.type = 'number';
      input.className = 'cm-input-money monto-input';
      input.dataset.tipo = item.tipo;
      input.dataset.categoria = item.categoria;
      input.value = DEMO_PRESETS[item.categoria] || 0;

      input.addEventListener('input', () => {
        recalcularTotales();
        actualizarDonaGastos();
      });

      tdMonto.appendChild(input);
      tr.appendChild(tdNombre);
      tr.appendChild(tdMonto);

      if (item.tipo === 'ingreso') tIng.appendChild(tr);
      else if (item.tipo === 'gasto') tGas.appendChild(tr);
      else if (item.tipo === 'ahorro') tAho.appendChild(tr);
    });

    recalcularTotales();
    actualizarDonaGastos();
  }

  /* ---------- TOTALES Y DONA ---------- */
  const spanTotalIngresos = document.getElementById('totalIngresos');
  const spanTotalGastos   = document.getElementById('totalGastos');
  const spanTotalAhorro   = document.getElementById('totalAhorro');
  const spanSaldoPres     = document.getElementById('saldoPresupuesto');

  function recalcularTotales() {
    let totIng = 0, totGas = 0, totAho = 0;

    document.querySelectorAll('.monto-input').forEach(inp => {
      const v = parseFloat(inp.value) || 0;
      const tipo = inp.dataset.tipo;
      if (tipo === 'ingreso') totIng += v;
      else if (tipo === 'gasto') totGas += v;
      else if (tipo === 'ahorro') totAho += v;
    });

    spanTotalIngresos.textContent = formatMoney(totIng);
    spanTotalGastos.textContent   = formatMoney(totGas);
    spanTotalAhorro.textContent   = formatMoney(totAho);
    spanSaldoPres.textContent     = formatMoney(totIng - totGas - totAho);

    // Guardar en localStorage para vs real
    const data = { totIng, totGas, totAho };
    localStorage.setItem('presupuesto-totales', JSON.stringify(data));
  }

  function actualizarDonaGastos() {
    const labels = [];
    const data = [];

    document.querySelectorAll('.monto-input').forEach(inp => {
      if (inp.dataset.tipo !== 'gasto') return;
      const cat = inp.dataset.categoria;
      const v = parseFloat(inp.value) || 0;
      labels.push(cat);
      data.push(v);
    });

    const ctx = document.getElementById('chartGastos').getContext('2d');

    if (chartGastos) chartGastos.destroy();

    chartGastos = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels,
        datasets: [{
          data,
        }]
      },
      options: {
        plugins: {
          legend: {
            position: 'bottom',
          }
        },
        cutout: '65%'
      }
    });
  }

  /* ---------- VS REAL ---------- */

  const kpiPresupuestoMes = document.getElementById('kpiPresupuestoMes');
  const kpiGastoReal      = document.getElementById('kpiGastoReal');
  const kpiDiferencia     = document.getElementById('kpiDiferencia');
  const porcUsoMesSpan    = document.getElementById('porcUsoMes');
  const montoDisponibleVs = document.getElementById('montoDisponibleVs');
  const tbodyVsReal       = document.getElementById('tbodyVsReal');
  const listaDesvios      = document.getElementById('listaDesvios');
  const selectAreaVsReal  = document.getElementById('selectAreaVsReal');

  function actualizarVsReal() {
    const inputs = document.querySelectorAll('.monto-input');
    const filas = [];

    let totalPresIngreso = 0, totalRealIngreso = 0;
    let totalPresGasto   = 0, totalRealGasto   = 0;
    let totalPresAhorro  = 0, totalRealAhorro  = 0;

    // Factores fijos demo
    const factoresIngreso = {
      'Pago por trabajo': 1.00,
      'Salario': 1.00,
      'Negocio propio': 0.95,
      'Bono': 1.10
    };

    const factoresGasto = {
      'Vivienda': 0.98,
      'Alimentación': 1.13,
      'Transporte': 0.79,
      'Ocio': 0.53
    };

    const factoresAhorro = {
      'Fondo de emergencia': 0.80,
      'Inversión': 0.90,
      'Ahorro general': 0.70
    };

    inputs.forEach(input => {
      const tipo = input.dataset.tipo;
      const cat  = input.dataset.categoria;
      const pres = parseFloat(input.value) || 0;
      if (pres <= 0) return;

      let factor = 1;
      if (tipo === 'ingreso') {
        factor = (cat in factoresIngreso) ? factoresIngreso[cat] : 1.0;
      } else if (tipo === 'gasto') {
        factor = (cat in factoresGasto) ? factoresGasto[cat] : 0.9;
      } else if (tipo === 'ahorro') {
        factor = (cat in factoresAhorro) ? factoresAhorro[cat] : 0.7;
      }

      const real = Math.round(pres * factor);
      const diff = real - pres;
      const porc = pres > 0 ? (real / pres) * 100 : 0;

      if (tipo === 'ingreso') {
        totalPresIngreso += pres;
        totalRealIngreso += real;
      } else if (tipo === 'gasto') {
        totalPresGasto += pres;
        totalRealGasto += real;
      } else if (tipo === 'ahorro') {
        totalPresAhorro += pres;
        totalRealAhorro += real;
      }

      filas.push({ cat, tipo, pres, real, diff, porc });
    });

    filasUltimoCalculo = filas;

    const totalPresOutMensual = totalPresGasto + totalPresAhorro;
    const totalRealOutMensual = totalRealGasto + totalRealAhorro;

    const factorPeriodo = (modoPeriodo === 'anual') ? 12 : 1;

    const totalPresOut = totalPresOutMensual * factorPeriodo;
    const totalRealOut = totalRealOutMensual * factorPeriodo;

    kpiPresupuestoMes.textContent = formatMoney(totalPresOut);
    kpiGastoReal.textContent      = formatMoney(totalRealOut);
    kpiDiferencia.textContent     = formatMoney(totalPresOut - totalRealOut);

    const porcUso = totalPresOut > 0 ? (totalRealOut / totalPresOut) * 100 : 0;
    porcUsoMesSpan.textContent    = porcUso.toFixed(0) + '%';
    montoDisponibleVs.textContent = formatMoney(totalPresOut - totalRealOut);

    // Tabla
    tbodyVsReal.innerHTML = '';
    filas.sort((a, b) => b.porc - a.porc);

    filas.forEach(f => {
      const presEsc = f.pres * factorPeriodo;
      const realEsc = f.real * factorPeriodo;
      const diffEsc = realEsc - presEsc;

      const diffTexto = (diffEsc >= 0 ? '+' : '') + formatMoney(diffEsc);

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${f.cat}</td>
        <td>${f.tipo.charAt(0).toUpperCase() + f.tipo.slice(1)}</td>
        <td>${formatMoney(presEsc)}</td>
        <td>${formatMoney(realEsc)}</td>
        <td>${diffTexto}</td>
        <td>${f.porc.toFixed(0)}%</td>
      `;
      tbodyVsReal.appendChild(tr);
    });

    // Lista de desvíos (Gastos + Ahorro)
    listaDesvios.innerHTML = '';
    filas
      .filter(f => f.tipo !== 'ingreso')
      .slice(0, 3)
      .forEach(f => {
        let badgeClass = 'green';
        if (f.porc > 110) badgeClass = 'red';
        else if (f.porc > 95) badgeClass = 'yellow';

        const presEsc = f.pres * factorPeriodo;
        const realEsc = f.real * factorPeriodo;

        const item = document.createElement('div');
        item.className = 'cm-category-item';
        item.innerHTML = `
          <div class="cm-category-top">
            <span class="cm-category-name">${f.cat}</span>
            <span class="cm-category-amounts">${formatMoney(presEsc)} / ${formatMoney(realEsc)}</span>
          </div>
          <div class="cm-category-bar">
            <div class="cm-category-bar-fill" style="width:${Math.min(f.porc,130)}%;"></div>
          </div>
          <div class="cm-category-top" style="margin-top:4px;">
            <span class="cm-badge ${badgeClass}">${f.porc.toFixed(0)}% del presupuesto</span>
          </div>
        `;
        listaDesvios.appendChild(item);
      });

    // Actualizar gráfico vertical según área seleccionada
    if (selectAreaVsReal) {
      actualizarGraficoVsReal(selectAreaVsReal.value);
    }
  }

  function actualizarGraficoVsReal(area) {
    if (!filasUltimoCalculo.length) return;
    const factorPeriodo = (modoPeriodo === 'anual') ? 12 : 1;

    const rows = filasUltimoCalculo.filter(f => f.tipo === area);
    if (!rows.length) {
      if (chartVsReal) chartVsReal.destroy();
      return;
    }

    const labels = rows.map(r => r.cat);
    const dataPres = rows.map(r => r.pres * factorPeriodo);
    const dataReal = rows.map(r => r.real * factorPeriodo);

    const ctx = document.getElementById('chartVsReal').getContext('2d');
    if (chartVsReal) chartVsReal.destroy();

    chartVsReal = new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [
          {
            label: 'Presupuesto',
            data: dataPres,
          },
          {
            label: 'Real (demo)',
            data: dataReal,
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
          }
        },
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  }

  /* ---------- TOGGLE MENSUAL / ANUAL (SINCRONIZADO) ---------- */

  function configurarTogglesPeriodo() {
    const grupos = [
      document.getElementById('toggleTipo'),
      document.getElementById('segmentTipoLocal')
    ];

    grupos.forEach(grupo => {
      if (!grupo) return;
      grupo.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          modoPeriodo = btn.dataset.tipo;

          grupos.forEach(g => {
            if (!g) return;
            g.querySelectorAll('button').forEach(b => {
              b.classList.toggle('active', b.dataset.tipo === modoPeriodo);
            });
          });

          // Cuando cambie el período, recalculamos vs real (escala mensual/anual)
          actualizarVsReal();
        });
      });
    });
  }

  /* ---------- FLUJO BOTONES ---------- */

  document.getElementById('btnIrMontos').addEventListener('click', () => {
    const cats = leerCategoriasActivas();
    localStorage.setItem('presupuesto-categorias', JSON.stringify(cats));
    construirTablasMontos(cats);
    mostrarVista('montos');
  });

  document.getElementById('btnGuardarIrVsReal').addEventListener('click', () => {
    actualizarVsReal();
    mostrarVista('vsreal');
  });

  if (selectAreaVsReal) {
    selectAreaVsReal.addEventListener('change', () => {
      actualizarGraficoVsReal(selectAreaVsReal.value);
    });
  }

  /* ---------- INIT ---------- */

  document.addEventListener('DOMContentLoaded', () => {
    // Abrir primer bloque por defecto
    document.querySelectorAll('.bloque-sector').forEach((b,i) => {
      if (i === 0) b.classList.add('abierto');
    });

    // Demo inicial: usar categorías activas por defecto
    const cats = leerCategoriasActivas();
    localStorage.setItem('presupuesto-categorias', JSON.stringify(cats));
    construirTablasMontos(cats);

    configurarTogglesPeriodo();
  });
</script>
</body>
</html>
