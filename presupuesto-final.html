<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Presupuesto – Demo Completa Cada Menudo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Nunito -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet"/>

  <!-- Chart.js para la dona -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --cm-primary: #3956e8;
      --cm-secondary: #7459d9;
      --cm-bg: #f5f6ff;
      --cm-card-bg: #ffffff;
      --cm-text: #0f172a;
      --cm-muted: #64748b;
      --cm-border: #e5e7eb;
      --radius-card: 16px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--cm-bg);
      color: var(--cm-text);
    }

    .cm-page {
      padding: 24px 32px 32px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header general */
    .cm-page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .cm-page-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cm-breadcrumb {
      font-size: 0.8rem;
      color: var(--cm-muted);
    }

    .cm-page-title h1 {
      font-size: 1.8rem;
      font-weight: 800;
    }

    .cm-page-subtitle {
      font-size: 0.95rem;
      color: var(--cm-muted);
      margin-top: 4px;
    }

    /* NAV TABS */
    .cm-subnav {
      display: flex;
      gap: 8px;
      margin: 10px 0 18px 0;
      border-bottom: 1px solid var(--cm-border);
    }

    .cm-subnav button {
      border: none;
      background: transparent;
      padding: 8px 14px;
      font-size: 0.9rem;
      border-radius: 999px 999px 0 0;
      color: var(--cm-muted);
      cursor: pointer;
      position: relative;
      top: 1px;
    }

    .cm-subnav button.active {
      background: #ffffff;
      color: var(--cm-primary);
      font-weight: 700;
      box-shadow: 0 -1px 0 #ffffff, 0 0 0 1px var(--cm-border), 0 6px 16px rgba(15, 23, 42, 0.06);
    }

    /* Tarjetas base */
    .cm-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 18px 20px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 18px;
    }

    .cm-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .cm-card-title {
      font-size: 1rem;
      font-weight: 700;
    }

    .cm-card-subtitle {
      font-size: 0.85rem;
      color: var(--cm-muted);
      margin-top: 2px;
    }

    /* Toggle tipo presupuesto + dropdown alineado */
    .cm-type-row {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .cm-segment {
      display: inline-flex;
      padding: 3px;
      border-radius: 999px;
      background: #eef2ff;
      gap: 4px;
    }

    .cm-segment button {
      border: none;
      background: transparent;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.9rem;
      color: var(--cm-muted);
      cursor: pointer;
    }

    .cm-segment button.active {
      background: #ffffff;
      color: var(--cm-primary);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(148, 163, 184, 0.4);
    }

    .cm-select-inline {
      border-radius: 999px;
      border: 1px solid var(--cm-border);
      background: #fff;
      padding: 6px 12px;
      font-size: 0.9rem;
      color: var(--cm-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      min-width: 140px;
    }

    .cm-helper-text {
      font-size: 0.8rem;
      color: var(--cm-muted);
      margin-top: 6px;
    }

    .cm-highlight {
      color: var(--cm-primary);
      font-weight: 600;
    }

    /* Botón principal */
    .cm-actions-row {
      margin-top: 16px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .cm-btn-primary {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--cm-primary), var(--cm-secondary));
      color: #ffffff;
      font-size: 0.95rem;
      padding: 10px 24px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(55, 65, 81, 0.25);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .cm-btn-primary:hover {
      opacity: 0.96;
      transform: translateY(-1px);
    }

    .cm-btn-ghost {
      border-radius: 999px;
      border: 1px solid var(--cm-border);
      background: #ffffff;
      color: var(--cm-muted);
      font-size: 0.9rem;
      padding: 8px 18px;
      font-weight: 600;
      cursor: pointer;
    }

    /* ===================== */
    /*   ESTILOS CATEGORÍAS  */
    /* ===================== */

    .seccion-categorias {
      margin-top: 0.5rem;
    }

    .titulo-categorias {
      font-size: 1.1rem;
      font-weight: 700;
      color: #111827;
      margin: 0.5rem 0 1rem 0;
      padding-left: 0.25rem;
    }

    .bloque-sector {
      background: #ffffff;
      border-radius: 20px;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
      margin: 0 auto 1.2rem;
      max-width: 100%;
    }

    .encabezado {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.75rem;
      font-size: 1.05rem;
      font-weight: bold;
      padding: 1.1rem 1rem;
      cursor: pointer;
    }

    .icono-ingresos,
    .icono-gastos,
    .icono-ahorro {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: 32px;
      background-repeat: no-repeat;
      background-position: center;
    }

    .icono-ingresos {
      background-color: #F4F2FF;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/ingreso.png');
    }

    .icono-gastos {
      background-color: #F3F4F6;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/gastos.png');
    }

    .icono-ahorro {
      background-color: #FCFAEA;
      background-image: url('https://cadamenudo.github.io/UI-UX/assets/icons/ahorro.png');
    }

    .contenido-bloque {
      display: none;
      padding: 1rem 2rem;
    }

    .bloque-sector.abierto .contenido-bloque {
      display: block;
    }

    .bloque-categoria {
      background: #fff;
      border-radius: 16px;
      padding: 1.25rem;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 1rem;
    }

    .titulo-categoria {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
    }

    .subcategorias {
      margin-top: 0.75rem;
      padding-left: 1rem;
      display: none;
    }

    .subcategorias.activo {
      display: block;
    }

    .fila {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #4F46E5;
    }

    input:checked + .slider:before {
      transform: translateX(20px);
    }

    .acciones {
      margin-top: 1rem;
      text-align: right;
    }

    .acciones button {
      background: #7459D9;
      color: white;
      border: none;
      padding: 0.4rem 0.75rem;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      margin-left: 0.5rem;
    }

    .editable-span {
      cursor: pointer;
    }

    .editable-input {
      font-family: inherit;
      font-size: 1rem;
      padding: 2px 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .pildora-recurrencia {
      background: #ECFDF3;
      color: #00AC4F;
      font-size: 0.75rem;
      font-weight: 500;
      border-radius: 999px;
      padding: 0.15rem 0.5rem;
      margin-left: 0.4rem;
      display: inline-block;
    }

    /* ================ */
    /*  TAB 2: MONTOS   */
    /* ================ */

    .cm-tab {
      display: none;
    }

    .cm-tab.active {
      display: block;
    }

    .cm-grid-montos {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.3fr);
      gap: 16px;
      align-items: flex-start;
    }

    .cm-grid-montos-left {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    .cm-montos-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 14px 14px 10px;
      box-shadow: var(--shadow-soft);
    }

    .cm-montos-card h2 {
      font-size: 0.95rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .cm-montos-card table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .cm-montos-card th,
    .cm-montos-card td {
      padding: 4px 4px;
      text-align: left;
    }

    .cm-montos-card th {
      color: var(--cm-muted);
      font-weight: 600;
    }

    .cm-montos-card tfoot td {
      font-weight: 700;
      border-top: 1px solid var(--cm-border);
      padding-top: 6px;
      font-size: 0.85rem;
    }

    .monto-input {
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--cm-border);
      padding: 2px 6px;
      font-size: 0.8rem;
      text-align: right;
    }

    .cm-resumen-lateral {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 16px 16px 12px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .cm-resumen-lateral h2 {
      font-size: 0.95rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .cm-totales-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.88rem;
    }

    .cm-total-line {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .cm-total-label {
      color: var(--cm-muted);
    }

    .cm-total-value {
      font-weight: 700;
    }

    .cm-dona-wrapper {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed var(--cm-border);
    }

    .cm-dona-wrapper h3 {
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .cm-dona-container {
      max-width: 260px;
      margin: 0 auto;
    }

    /* ================ */
    /* TAB 3: VS REAL   */
    /* ================ */

    .cm-banner {
      margin-top: 8px;
      margin-bottom: 20px;
      padding: 12px 16px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: var(--shadow-soft);
      background: #ecfdf3;
      color: #15803d;
      font-size: 0.95rem;
    }

    .cm-banner span.cm-banner-secondary {
      color: var(--cm-muted);
    }

    .cm-kpi-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .cm-kpi-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 16px 18px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cm-kpi-label {
      font-size: 0.85rem;
      color: var(--cm-muted);
    }

    .cm-kpi-value {
      font-size: 1.4rem;
      font-weight: 800;
    }

    .cm-kpi-sub {
      font-size: 0.85rem;
      color: var(--cm-muted);
    }

    .cm-main-row {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .cm-chart-placeholder {
      border-radius: 12px;
      border: 1px dashed #d4d4d8;
      background: #f9fafb;
      min-height: 220px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      color: var(--cm-muted);
      text-align: center;
      padding: 16px;
    }

    .cm-category-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
      margin-bottom: 12px;
    }

    .cm-category-item {
      border-radius: 10px;
      border: 1px solid var(--cm-border);
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.82rem;
    }

    .cm-category-top {
      display: flex;
      justify-content: space-between;
    }

    .cm-category-bar {
      position: relative;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .cm-category-bar-fill {
      position: absolute;
      inset: 0;
      width: 70%;
      background: linear-gradient(90deg, var(--cm-primary), var(--cm-secondary));
    }

    .cm-badge {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
    }

    .cm-badge.green { background: rgba(34, 197, 94, 0.08); color: #15803d; }
    .cm-badge.yellow { background: rgba(234, 179, 8, 0.08); color: #92400e; }
    .cm-badge.red { background: rgba(239, 68, 68, 0.08); color: #b91c1c; }

    .cm-table-card {
      background: var(--cm-card-bg);
      border-radius: var(--radius-card);
      padding: 16px 18px 12px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 20px;
    }

    .cm-table-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .cm-table-wrapper {
      border-radius: 12px;
      border: 1px solid var(--cm-border);
      overflow: auto;
      max-height: 320px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    thead {
      background: #f4f4ff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th, td {
      padding: 8px 10px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
      white-space: nowrap;
    }

    th {
      font-weight: 700;
      color: var(--cm-muted);
      font-size: 0.8rem;
    }

    tbody tr:nth-child(even) {
      background: #fafafa;
    }

    /* Responsivo */
    @media (max-width: 1024px) {
      .cm-grid-montos {
        grid-template-columns: minmax(0, 1fr);
      }
      .cm-main-row {
        grid-template-columns: minmax(0, 1fr);
      }
      .cm-kpi-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 768px) {
      .cm-page {
        padding: 16px;
      }
      .cm-kpi-row {
        grid-template-columns: minmax(0, 1fr);
      }
      .cm-page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
<main class="cm-page">
  <!-- HEADER GENERAL -->
  <header class="cm-page-header">
    <div class="cm-page-title">
      <span class="cm-breadcrumb">Tablero / Presupuesto</span>
      <h1>Presupuesto</h1>
      <p class="cm-page-subtitle">Configura, asigna montos y compara con tu gasto real.</p>
    </div>
  </header>

  <!-- NAV TABS -->
  <nav class="cm-subnav">
    <button type="button" class="active" data-tab="inicio">1. Configurar</button>
    <button type="button" data-tab="montos">2. Montos</button>
    <button type="button" data-tab="vsreal">3. Presupuesto vs real</button>
  </nav>

  <!-- ======================= -->
  <!-- TAB 1: CONFIGURAR       -->
  <!-- ======================= -->
  <section id="tab-inicio" class="cm-tab active">
    <!-- Tipo de presupuesto -->
    <section class="cm-card">
      <div class="cm-card-header">
        <div>
          <div class="cm-card-title">Tipo de presupuesto</div>
          <div class="cm-card-subtitle">Mensual o anual y periodo.</div>
        </div>
      </div>

      <div class="cm-type-row">
        <div class="cm-segment">
          <button class="active" type="button" id="btnMensual">Mensual</button>
          <button type="button" id="btnAnual">Anual</button>
        </div>

        <div class="cm-select-inline" id="selectorMes">
          <span>Mes:</span>
          <strong id="textoMes">Enero 2025</strong>
          ⌄
        </div>
      </div>

      <p class="cm-helper-text">
        Si eliges <span class="cm-highlight">mensual</span>, aplicas solo al mes elegido.
      </p>
    </section>

    <!-- Seleccionar categorías -->
    <section class="cm-card">
      <div class="cm-card-header">
        <div>
          <div class="cm-card-title">Selecciona categorías</div>
          <div class="cm-card-subtitle">Activa lo que quieres presupuestar.</div>
        </div>
      </div>

      <div class="seccion-categorias">
        <h3 class="titulo-categorias">Lista de Categorías</h3>

        <!-- INGRESOS -->
        <div class="bloque-sector" data-tipo="ingresos">
          <div class="encabezado" onclick="toggleBloque(this)">
            <div class="icono-ingresos"></div>
            <span>Ingresos</span>
          </div>
          <div class="contenido-bloque">

            <div class="bloque-categoria">
              <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                <span>Pago por trabajo</span>
                <label class="switch">
                  <input type="checkbox" checked>
                  <span class="slider"></span>
                </label>
              </div>
              <div class="subcategorias">
                <div class="fila">
                  <span class="editable-span" data-nombre="Salario">Salario</span>
                  <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                </div>
                <div class="fila">
                  <span class="editable-span" data-nombre="Bono">Bono</span>
                  <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                </div>
                <div class="fila">
                  <span class="editable-span" data-nombre="Negocio propio">Negocio propio</span>
                  <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                </div>
              </div>
            </div>

            <div class="bloque-categoria">
              <div class="titulo-categoria" onclick="toggleSubcategorias(this)">
                <span>Ingreso pasivo</span>
                <label class="switch">
                  <input type="checkbox">
                  <span class="slider"></span>
                </label>
              </div>
              <div class="subcategorias">
                <div class="fila">
                  <span class="editable-span" data-nombre="Dividendos">Dividendos</span>
                  <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                </div>
                <div class="fila">
                  <span class="editable-span" data-nombre="Renta inmueble">Renta inmueble</span>
                  <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- GASTOS -->
        <div class="bloque-sector" data-tipo="gastos">
          <div class="encabezado" onclick="toggleBloque(this)">
            <div class="icono-gastos"></div>
            <span>Gastos</span>
          </div>
          <div class="contenido-bloque" id="contenedorGastos"></div>
        </div>

        <!-- AHORRO -->
        <div class="bloque-sector" data-tipo="ahorro">
          <div class="encabezado" onclick="toggleBloque(this)">
            <div class="icono-ahorro"></div>
            <span>Ahorro</span>
          </div>
          <div class="contenido-bloque" id="contenedorAhorro"></div>
        </div>
      </div>

      <p class="cm-helper-text">
        Mejor empezar con pocas categorías y luego afinar.
      </p>

      <div class="cm-actions-row">
        <button type="button" class="cm-btn-primary" id="btnIrMontos">
          Continuar a montos
        </button>
      </div>
    </section>
  </section>

  <!-- ======================= -->
  <!-- TAB 2: MONTOS           -->
  <!-- ======================= -->
  <section id="tab-montos" class="cm-tab">
    <section class="cm-card">
      <div class="cm-card-header">
        <div>
          <div class="cm-card-title">Montos del presupuesto</div>
          <div class="cm-card-subtitle">Asigna cuánto quieres para cada categoría.</div>
        </div>
      </div>

      <div class="cm-grid-montos">
        <!-- Izquierda: tablas -->
        <div class="cm-grid-montos-left">
          <!-- INGRESOS -->
          <article class="cm-montos-card">
            <h2>Ingresos</h2>
            <table>
              <thead>
              <tr>
                <th>Categoría</th>
                <th style="text-align:right;">Monto</th>
              </tr>
              </thead>
              <tbody id="tbodyIngresos"></tbody>
              <tfoot>
              <tr>
                <td>Total ingresos</td>
                <td style="text-align:right;"><span id="totalIngresos">$0.00</span></td>
              </tr>
              </tfoot>
            </table>
          </article>

          <!-- GASTOS -->
          <article class="cm-montos-card">
            <h2>Gastos</h2>
            <table>
              <thead>
              <tr>
                <th>Categoría</th>
                <th style="text-align:right;">Monto</th>
              </tr>
              </thead>
              <tbody id="tbodyGastos"></tbody>
              <tfoot>
              <tr>
                <td>Total gastos</td>
                <td style="text-align:right;"><span id="totalGastos">$0.00</span></td>
              </tr>
              </tfoot>
            </table>
          </article>

          <!-- AHORRO -->
          <article class="cm-montos-card">
            <h2>Ahorro</h2>
            <table>
              <thead>
              <tr>
                <th>Categoría</th>
                <th style="text-align:right;">Monto</th>
              </tr>
              </thead>
              <tbody id="tbodyAhorro"></tbody>
              <tfoot>
              <tr>
                <td>Total ahorro</td>
                <td style="text-align:right;"><span id="totalAhorro">$0.00</span></td>
              </tr>
              </tfoot>
            </table>
          </article>
        </div>

        <!-- Derecha: resumen + dona -->
        <aside class="cm-resumen-lateral">
          <div>
            <h2>Totales del presupuesto</h2>
            <div class="cm-totales-row">
              <div class="cm-total-line">
                <span class="cm-total-label">Ingresos</span>
                <span class="cm-total-value" id="totalIngresosResumen">$0.00</span>
              </div>
              <div class="cm-total-line">
                <span class="cm-total-label">Gastos</span>
                <span class="cm-total-value" id="totalGastosResumen">$0.00</span>
              </div>
              <div class="cm-total-line">
                <span class="cm-total-label">Ahorro</span>
                <span class="cm-total-value" id="totalAhorroResumen">$0.00</span>
              </div>
              <div class="cm-total-line">
                <span class="cm-total-label">Disponible</span>
                <span class="cm-total-value" id="totalDisponible">$0.00</span>
              </div>
            </div>
          </div>

          <div class="cm-dona-wrapper">
            <h3>Gastos por categoría</h3>
            <div class="cm-dona-container">
              <canvas id="gastosDonut"></canvas>
            </div>
          </div>

          <div class="cm-actions-row">
            <button type="button" class="cm-btn-primary" id="btnIrVsReal">
              Ver presupuesto vs real
            </button>
          </div>
        </aside>
      </div>
    </section>
  </section>

  <!-- ======================= -->
  <!-- TAB 3: PRESUPUESTO VS REAL -->
  <!-- ======================= -->
  <section id="tab-vsreal" class="cm-tab">
    <section>
      <section class="cm-banner" id="bannerVsReal">
        <div>
          <strong>Resumen:</strong> estás usando el <strong id="porcUsoMes">0%</strong> de tu presupuesto.
        </div>
        <span class="cm-banner-secondary">
          Te quedan <strong id="montoDisponibleVs">$0</strong> para gastar sin salirte del plan.
        </span>
      </section>

      <section class="cm-kpi-row">
        <article class="cm-kpi-card">
          <span class="cm-kpi-label">Presupuesto del mes</span>
          <div class="cm-kpi-value" id="kpiPresupuestoMes">$0.00</div>
          <div class="cm-kpi-sub">Total planeado (gastos).</div>
        </article>
        <article class="cm-kpi-card">
          <span class="cm-kpi-label">Gasto real simulado</span>
          <div class="cm-kpi-value" id="kpiGastoReal">$0.00</div>
          <div class="cm-kpi-sub">Ejemplo para la demo.</div>
        </article>
        <article class="cm-kpi-card">
          <span class="cm-kpi-label">Diferencia</span>
          <div class="cm-kpi-value" id="kpiDiferencia">$0.00</div>
          <div class="cm-kpi-sub">Presupuesto – real.</div>
        </article>
      </section>

      <section class="cm-main-row">
        <article class="cm-card">
          <header class="cm-card-header">
            <h2>Presupuesto vs real (demo)</h2>
          </header>
          <div class="cm-chart-placeholder">
            Aquí podrías ver un gráfico de barras<br/>
            Presupuesto vs gasto real por categoría.
          </div>
        </article>

        <article class="cm-card">
          <header class="cm-card-header">
            <h2>Categorías con más desvío</h2>
          </header>
          <div class="cm-category-list" id="listaDesvios"></div>
        </article>
      </section>

      <section class="cm-table-card">
        <header class="cm-table-card-header">
          <h2>Detalle por categoría</h2>
        </header>
        <div class="cm-table-wrapper">
          <table>
            <thead>
            <tr>
              <th>Categoría</th>
              <th>Presupuesto</th>
              <th>Gasto real</th>
              <th>Diferencia</th>
              <th>% usado</th>
            </tr>
            </thead>
            <tbody id="tbodyVsReal"></tbody>
          </table>
        </div>
      </section>
    </section>
  </section>
</main>

<script>
  /* ------------------------- */
  /* NAV TABS                  */
  /* ------------------------- */
  const tabButtons = document.querySelectorAll('.cm-subnav button');
  const tabSections = {
    inicio: document.getElementById('tab-inicio'),
    montos: document.getElementById('tab-montos'),
    vsreal: document.getElementById('tab-vsreal')
  };

  function showTab(name) {
    tabButtons.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === name);
    });
    Object.entries(tabSections).forEach(([key, sec]) => {
      sec.classList.toggle('active', key === name);
    });
  }

  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      showTab(btn.dataset.tab);
    });
  });

  /* ------------------------- */
  /* TOGGLE BLOQUES CATEGORÍA  */
  /* ------------------------- */
  function toggleBloque(encabezado) {
    const parent = encabezado.closest('.bloque-sector');
    document.querySelectorAll('.bloque-sector').forEach(b => {
      if (b !== parent) b.classList.remove('abierto');
    });
    parent.classList.toggle('abierto');
  }

  function toggleSubcategorias(element) {
    const all = document.querySelectorAll('.subcategorias');
    all.forEach(sc => {
      if (sc !== element.nextElementSibling) sc.classList.remove('activo');
    });
    element.nextElementSibling.classList.toggle('activo');
  }

  /* ------------------------- */
  /* GASTOS / AHORRO PREDEFINIDO */
  /* ------------------------- */

  const categoriasGastos = {
    'Vivienda': ['Hipoteca / Alquiler', 'Servicios básicos', 'Mantenimiento'],
    'Alimentación': ['Supermercado', 'Comidas fuera'],
    'Transporte': ['Gasolina', 'Mantenimiento', 'Transporte público / Uber'],
    'Otros': ['Entretenimiento', 'Regalos', 'Suscripciones']
  };

  const categoriasAhorro = {
    'Emergencia': ['Fondo corto plazo', 'Fondo largo plazo'],
    'Meta específica': ['Vacaciones', 'Auto', 'Casa'],
    'Inversión': ['Cuenta brokerage', 'Fondo indexado']
  };

  const contenedorGastos = document.getElementById('contenedorGastos');
  const contenedorAhorro = document.getElementById('contenedorAhorro');

  function crearSectorDinamico(nombre, mapa, contenedor, tipo) {
    Object.entries(mapa).forEach(([cat, subs]) => {
      const div = document.createElement('div');
      div.className = 'bloque-categoria';

      const titulo = document.createElement('div');
      titulo.className = 'titulo-categoria';
      titulo.onclick = () => toggleSubcategorias(titulo);

      const spanTitulo = document.createElement('span');
      spanTitulo.textContent = cat;
      titulo.appendChild(spanTitulo);

      const switchLabel = document.createElement('label');
      switchLabel.className = 'switch';
      switchLabel.innerHTML = `<input type="checkbox" checked><span class="slider"></span>`;
      titulo.appendChild(switchLabel);

      const subDiv = document.createElement('div');
      subDiv.className = 'subcategorias';

      subs.forEach(sub => {
        const fila = document.createElement('div');
        fila.className = 'fila';

        const span = document.createElement('span');
        span.className = 'editable-span';
        span.textContent = sub;
        span.setAttribute('data-nombre', sub);

        const switchSub = document.createElement('label');
        switchSub.className = 'switch';
        switchSub.innerHTML = `<input type="checkbox" checked><span class="slider"></span>`;

        fila.appendChild(span);
        fila.appendChild(switchSub);
        subDiv.appendChild(fila);
      });

      div.appendChild(titulo);
      div.appendChild(subDiv);
      contenedor.appendChild(div);
    });
  }

  crearSectorDinamico('Gastos', categoriasGastos, contenedorGastos, 'gastos');
  crearSectorDinamico('Ahorro', categoriasAhorro, contenedorAhorro, 'ahorro');

  /* ------------------------- */
  /* CASO DEMO                 */
  /* ------------------------- */

  const demoMontos = {
    ingresos: {
      'Salario': 2800,
      'Negocio propio': 400
    },
    gastos: {
      'Vivienda': 1200,
      'Alimentación': 600,
      'Transporte': 250,
      'Otros': 150
    },
    ahorro: {
      'Emergencia': 300,
      'Meta específica': 200,
      'Inversión': 150
    }
  };

  /* ------------------------- */
  /* OBTENER CATEGORÍAS ACTIVAS */
  /* ------------------------- */
  function getActiveSubcategorias(tipo) {
    const sector = document.querySelector(`.bloque-sector[data-tipo="${tipo}"]`);
    if (!sector) return [];
    const filas = sector.querySelectorAll('.subcategorias .fila');
    const res = [];
    filas.forEach(fila => {
      const input = fila.querySelector('.switch input');
      if (input && input.checked) {
        const span = fila.querySelector('.editable-span');
        if (span) {
          const nombre = span.getAttribute('data-nombre') || span.textContent.trim();
          if (nombre) res.push(nombre);
        }
      }
    });
    return [...new Set(res)];
  }

  /* ------------------------- */
  /* TAB 2: CONSTRUIR TABLAS   */
  /* ------------------------- */

  const tbodyIngresos = document.getElementById('tbodyIngresos');
  const tbodyGastos = document.getElementById('tbodyGastos');
  const tbodyAhorro = document.getElementById('tbodyAhorro');

  function crearFilaTabla(tbody, nombre, tipo, montoDemo = 0) {
    const tr = document.createElement('tr');

    const tdNombre = document.createElement('td');
    tdNombre.textContent = nombre;

    const tdMonto = document.createElement('td');
    tdMonto.style.textAlign = 'right';

    const input = document.createElement('input');
    input.type = 'number';
    input.step = '0.01';
    input.className = 'monto-input';
    input.dataset.tipo = tipo;
    input.dataset.categoria = nombre;
    input.value = montoDemo.toString();

    tdMonto.appendChild(input);
    tr.appendChild(tdNombre);
    tr.appendChild(tdMonto);
    tbody.appendChild(tr);
  }

  function construirTablasMontos(ingresosActivos, gastosActivos, ahorroActivos) {
    tbodyIngresos.innerHTML = '';
    tbodyGastos.innerHTML = '';
    tbodyAhorro.innerHTML = '';

    const ing = ingresosActivos.length ? ingresosActivos : Object.keys(demoMontos.ingresos);
    const gas = gastosActivos.length ? gastosActivos : Object.keys(demoMontos.gastos);
    const aho = ahorroActivos.length ? ahorroActivos : Object.keys(demoMontos.ahorro);

    ing.forEach(n => crearFilaTabla(tbodyIngresos, n, 'ingreso', demoMontos.ingresos[n] || 0));
    gas.forEach(n => crearFilaTabla(tbodyGastos, n, 'gasto', demoMontos.gastos[n] || 0));
    aho.forEach(n => crearFilaTabla(tbodyAhorro, n, 'ahorro', demoMontos.ahorro[n] || 0));

    recalcularTotalesYDona();
  }

  /* ------------------------- */
  /* TOTALES + DONA            */
  /* ------------------------- */
  const totalIngresosSpan = document.getElementById('totalIngresos');
  const totalGastosSpan = document.getElementById('totalGastos');
  const totalAhorroSpan = document.getElementById('totalAhorro');

  const totalIngresosResumen = document.getElementById('totalIngresosResumen');
  const totalGastosResumen = document.getElementById('totalGastosResumen');
  const totalAhorroResumen = document.getElementById('totalAhorroResumen');
  const totalDisponibleSpan = document.getElementById('totalDisponible');

  let gastosChart = null;

  function formatMoney(n) {
    return '$' + (n || 0).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
  }

  function recalcularTotalesYDona() {
    const inputs = document.querySelectorAll('.monto-input');
    let totalIng = 0, totalGas = 0, totalAho = 0;

    const gastosPorCat = {};

    inputs.forEach(input => {
      const tipo = input.dataset.tipo;
      const cat = input.dataset.categoria;
      const val = parseFloat(input.value) || 0;

      if (tipo === 'ingreso') totalIng += val;
      if (tipo === 'gasto') {
        totalGas += val;
        gastosPorCat[cat] = (gastosPorCat[cat] || 0) + val;
      }
      if (tipo === 'ahorro') totalAho += val;
    });

    const disponible = totalIng - totalGas - totalAho;

    totalIngresosSpan.textContent = formatMoney(totalIng);
    totalGastosSpan.textContent = formatMoney(totalGas);
    totalAhorroSpan.textContent = formatMoney(totalAho);

    totalIngresosResumen.textContent = formatMoney(totalIng);
    totalGastosResumen.textContent = formatMoney(totalGas);
    totalAhorroResumen.textContent = formatMoney(totalAho);
    totalDisponibleSpan.textContent = formatMoney(disponible);

    // DONA
    const labels = Object.keys(gastosPorCat);
    const data = Object.values(gastosPorCat);

    const ctx = document.getElementById('gastosDonut').getContext('2d');
    if (gastosChart) gastosChart.destroy();

    if (labels.length === 0 || data.reduce((a,b)=>a+b,0) === 0) {
      // Si no hay data, crea dona vacía pequeña
      gastosChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Sin datos'],
          datasets: [{
            data: [1]
          }]
        },
        options: {
          plugins: {
            legend: { display: false }
          },
          cutout: '70%'
        }
      });
    } else {
      gastosChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{
            data
          }]
        },
        options: {
          plugins: {
            legend: {
              position: 'bottom',
              labels: { boxWidth: 10 }
            }
          },
          cutout: '65%'
        }
      });
    }
  }

  document.addEventListener('input', function (e) {
    if (e.target.classList.contains('monto-input')) {
      recalcularTotalesYDona();
    }
  });

  /* ------------------------- */
  /* BOTONES FLUJO             */
  /* ------------------------- */
  document.getElementById('btnIrMontos').addEventListener('click', () => {
    const ing = getActiveSubcategorias('ingresos');
    const gas = getActiveSubcategorias('gastos');
    const aho = getActiveSubcategorias('ahorro');

    construirTablasMontos(ing, gas, aho);
    showTab('montos');
  });

  document.getElementById('btnIrVsReal').addEventListener('click', () => {
    actualizarVsReal();
    showTab('vsreal');
  });

  /* ------------------------- */
  /* TAB 3: VS REAL (DEMO)     */
  /* ------------------------- */
  const kpiPresupuestoMes = document.getElementById('kpiPresupuestoMes');
  const kpiGastoReal = document.getElementById('kpiGastoReal');
  const kpiDiferencia = document.getElementById('kpiDiferencia');
  const porcUsoMes = document.getElementById('porcUsoMes');
  const montoDisponibleVs = document.getElementById('montoDisponibleVs');
  const tbodyVsReal = document.getElementById('tbodyVsReal');
  const listaDesvios = document.getElementById('listaDesvios');

  function actualizarVsReal() {
    const inputs = document.querySelectorAll('.monto-input[data-tipo="gasto"]');
    const filas = [];
    let totalPres = 0;
    let totalReal = 0;

    inputs.forEach(input => {
      const cat = input.dataset.categoria;
      const pres = parseFloat(input.value) || 0;
      if (pres <= 0) return;

      // para demo, simulamos gasto real 0.8–1.2 del presupuesto
      const factor = 0.8 + Math.random() * 0.4;
      const real = Math.round(pres * factor);

      totalPres += pres;
      totalReal += real;

      const diff = real - pres;
      const porc = pres > 0 ? (real / pres) * 100 : 0;

      filas.push({ cat, pres, real, diff, porc });
    });

    kpiPresupuestoMes.textContent = formatMoney(totalPres);
    kpiGastoReal.textContent = formatMoney(totalReal);
    const diffTotal = totalPres - totalReal;
    kpiDiferencia.textContent = formatMoney(diffTotal);

    const porcUso = totalPres > 0 ? (totalReal / totalPres) * 100 : 0;
    porcUsoMes.textContent = porcUso.toFixed(0) + '%';
    montoDisponibleVs.textContent = formatMoney(totalPres - totalReal);

    tbodyVsReal.innerHTML = '';
    listaDesvios.innerHTML = '';

    filas.sort((a,b)=>b.porc - a.porc);

    filas.forEach(f => {
      // tabla
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${f.cat}</td>
        <td>${formatMoney(f.pres)}</td>
        <td>${formatMoney(f.real)}</td>
        <td>${(f.diff>=0?'+':'') + formatMoney(f.diff).replace('$','$')}</td>
        <td>${f.porc.toFixed(0)}%</td>
      `;
      tbodyVsReal.appendChild(tr);
    });

    // top 3 desvíos
    filas.slice(0,3).forEach(f => {
      const item = document.createElement('div');
      item.className = 'cm-category-item';

      let badgeClass = 'green';
      if (f.porc > 110) badgeClass = 'red';
      else if (f.porc > 95) badgeClass = 'yellow';

      item.innerHTML = `
        <div class="cm-category-top">
          <span>${f.cat}</span>
          <span>${formatMoney(f.pres)} / ${formatMoney(f.real)}</span>
        </div>
        <div class="cm-category-bar">
          <div class="cm-category-bar-fill" style="width:${Math.min(f.porc,130)}%;"></div>
        </div>
        <div class="cm-category-top" style="margin-top:4px;">
          <span class="cm-badge ${badgeClass}">${f.porc.toFixed(0)}% del presupuesto</span>
        </div>
      `;
      listaDesvios.appendChild(item);
    });
  }

  /* ------------------------- */
  /* INIT: DEMO DIRECTO EN MONTOS */
  /* ------------------------- */
  // Abrimos bloques de categorías por default
  document.querySelectorAll('.bloque-sector').forEach(b => b.classList.remove('abierto'));

  // Para que veas todo funcionando rápido:
  // construimos montos con demo al cargar;
  // luego igual puedes volver a "Configurar" y rehacer.
  construirTablasMontos([], [], []);
</script>
</body>
</html>
